# ====================================================================
## document bundles
# ====================================================================
---
if: tool_ID == "JOD_only"
objects:
  - al_user_bundle: ALDocumentBundle.using(elements=[judgment_ccmlh412], filename="Michigan Divorce and Custody JOD", title="Divorce and Custody JOD", enabled=True)
  # - al_court_bundle: [will be same as above, JOD_only doesn't have instructions anyway]
---
if: tool_ID == "divorce_complaint"
objects:
  - al_user_bundle: ALDocumentBundle.using(elements=[judgment_ccmlh412, verified_statement_foc_23, domestic_relations_verified_financial_cc_320, child_support_services_dhs_1201d, fee_waiver_attachment, protected_pii_mc_97a_attachment], filename="Michigan Divorce and Custody JOD", title="Divorce and Custody JOD", enabled=True)
  # - al_court_bundle: [will be same as above, except without the instructions]
---
# ====================================================================
## Enabling logic
# ====================================================================
---
### List of enabling logic that is TBD

---
# not in JOD_only bundle
code: |
  if tool_ID == "divorce_complaint":
    verified_statement_foc_23.enabled = there_are_marital_children
  elif tool_ID == "divorce_answer":
    if there_are_marital_children and filing_counterclaim:
      verified_statement_foc_23.enabled = True
    else:
      verified_statement_foc_23.enabled = False
  elif tool_ID == "custody_complaint":
    verified_statement_foc_23.enabled = True
  elif tool_ID == "custody_answer":
    verified_statement_foc_23.enabled = filing_counterclaim
---
# not in JOD_only bundle
code: |
  domestic_relations_verified_financial_cc_320.enabled = True
---
code: |
  if tool_ID in ["divorce_complaint", "custody_complaint"]:
    child_support_services_dhs_1201d.enabled = there_are_marital_children
---
# note fee waiver logic is largely in fee waiver tool
code: |
  if tool_ID in ["divorce_complaint", "custody_complaint"]:
    fee_waiver_attachment.enabled = pa_received
    if pa_received:
      protected_pii_mc_97a_attachment.enabled = insert_pii_form
    else:
      protected_pii_mc_97a_attachment.enabled = False
  else:
    fee_waiver_attachment.enabled = False
    protected_pii_mc_97a_attachment.enabled = False
---
# ====================================================================
## specific form objects and attachment blocks
# ====================================================================
---
# --------------------------------------------------------------------
## Example form title or category here
# --------------------------------------------------------------------
---
---
# --------------------------------------------------------------------
## Verified Statement, FOC 23
# --------------------------------------------------------------------
---
objects:
  - verified_statement_foc_23: ALDocument.using(title="Verified Statement - FOC 23", filename="Verified Statement - FOC 23")
  - verified_statement_foc_23_addendum: ALDocument.using(title="Verified Statement - FOC 23", filename="Verified Statement - FOC 23")
---
attachment:
  variable name: verified_statement_foc_23.addendum
  docx template file: verified_statement_foc23_addendum.docx
# above is how I would set it up if doing true overflow addendum (from small claims e.g.)
# see "FOC 23 addendum CO" for contents
---
attachment:
  - name: Verified Statement - FOC 23
    filename: Verified Statement - FOC 23
    variable name: verified_statement_foc_23[i]
    pdf template file: verified_statement_foc23.pdf
    skip undefined: True
    editable: False
    fields:
      - trial_court_circuit: ${the_court.number}
      - trial_court_address_county: ${the_court.address.county.upper()}
      - docket_number: ${docket_number}
      - docket_number__1: ${docket_number}
      - friend_of_court_address_on_one_line: ${the_foc.address.on_one_line()}
      - friend_of_court_phone_number: ${ the_foc.phone }
      - users1_name_last_first_middle: ${ users[0].name.last + " " + users[0].name.first + " " + users[0].name.middle }
      - users1_aliases: |
          % if users[0].has_alias:
          ${ users[0].aliases }
          % endif
      - users1_birthdate: ${ users[0].birthdate}
      - users1_ssn: ${ users[0].ssn }
      - users1_driver_license_and_state: ${ users[0].license_number + " " + users[0].license_state }
      - users1_address_on_one_line: |
          % if confidential_contact_info_yn:
          Confidential- Mailing: ${ users[0].address.on_one_line() }
          % else:
          % if users[0].mailing_address.yesno:
          Mailing: ${ users[0].mailing_address.on_one_line() + " "  }
          % endif
          Residence: ${ users[0].address.on_one_line() }
          % endif
      - users1_email: ${ users[0].email }
      - users1_height: ${ users[0].height }
      - users1_weight: ${ users[0].weight if users[0].weight > 0 else "" }
      - users1_race: |
          % if users[0].race == "Other":
          ${users[0].other_race_description}
          % else:
          ${ users[0].race }
          % endif
      - users1_gender: ${ users[0].gender }
      - users1_hair_color: ${ users[0].hair_color }
      - users1_eye_color: ${ users[0].eye_color }
      - users1_scars_tattoos: ${ users[0].other_identifying_info }
      - users1_employer_name_address: |
          % if users[0].has_job:
          ${ users[0].job.employer.name.first } ${ users[0].job.employer.address.on_one_line() if users[0].job.employer.address.address != "" else "" }
          % endif
      - users1_gross_weekly_income: |
          % if users[0].has_job:
          % if users[0].income.total() > 0:
          $ ${ round(users[0].income.total() / 52, 2) }
          % endif
          % endif
      - users1_applied_public_assistance_yes: ${True if pa_status in ["gets_assistance", "applied"] else False }
      - users1_applied_public_assistance_no: ${True if pa_status not in ["gets_assistance", "applied"] else False }
      - users1_public_assistance_type_case_number: |
          % if pa_status == "gets_assistance":
          ${ comma_and_list(public_assistance_list) } Case number: ${ comma_and_list(pa_case_numbers_foc_23) }
          % elif pa_status == "applied":
          Applied for ${ public_assistance_list }
          % endif
      - users1_other_citizenship: |
          % if users[0].has_foreign_citizenship:
          ${ users[0].countries_of_citizenship }
          % endif
      - users1_foreign_ids: |
          % if users[0].has_foreign_citizenship:
          ${ users[0].foreign_identity_documents }
          % endif
      - other_parties1_name_last_first_middle: ${ other_parties[0].name.last + " " + other_parties[0].name.first + " " + other_parties[0].name.middle }
      - other_parties1_aliases: |
          % if other_parties[0].has_alias:
          ${ other_parties[0].aliases }
          % endif
      - other_parties1_birthdate: ${ other_parties[0].birthdate}
      - other_parties1_ssn: ${ other_parties[0].ssn }
      - other_parties1_driver_license_and_state: ${ other_parties[0].license_number + " " + other_parties[0].license_state }
      - other_parties1_address_on_one_line: |
          % if other_parties[0].mailing_address.yesno:
          Mailing: ${ other_parties[0].mailing_address.on_one_line() + " " }
          % endif
          Residence: ${ other_parties[0].address.on_one_line() }
      - other_parties1_email: ${ other_parties[0].email }
      - other_parties1_height: ${ other_parties[0].height }
      - other_parties1_weight: ${ other_parties[0].weight if other_parties[0].weight > 0 else "" }
      - other_parties1_race: |
          % if other_parties[0].race == "Other":
          ${other_parties[0].other_race_description}
          % else:
          ${ other_parties[0].race }
          % endif
      - other_parties1_gender: ${ other_parties[0].gender }
      - other_parties1_hair_color: ${ other_parties[0].hair_color }
      - other_parties1_eye_color: ${ other_parties[0].eye_color }
      - other_parties1_scars_tattoos: ${ other_parties[0].other_identifying_info }
      - other_parties1_employer_name_address: |
          % if other_parties[0].has_job:
          ${ other_parties[0].job.employer.name.first } ${ other_parties[0].job.employer.address.on_one_line() if other_parties[0].job.employer.address.address != "" else "" }
          % endif
      - other_parties1_gross_weekly_income: |
          % if other_parties[0].has_job:
          % if other_parties[0].income.total() > 0:
          $ ${ round(other_parties[0].income.total() / 52, 2) }
          % endif
          % endif
      - other_parties1_applied_public_assistance_yes: ${True if other_party_pa_status in ["gets_assistance", "applied"] else False }
      - other_parties1_applied_public_assistance_no: ${True if other_party_pa_status == "none" else False }
      - other_parties1_applied_public_assistance_unsure: ${True if other_party_pa_status == "unknown" else False }
      - other_parties1_public_assistance_type_case_number: |
          % if other_party_pa_status == "gets_assistance":
          ${ comma_and_list(op_public_assistance_list) } Case number: ${ comma_and_list(op_pa_case_numbers_foc_23) }
          % elif other_party_pa_status == "applied":
          Applied for ${ op_public_assistance_list }
          % endif
      - other_parties1_other_citizenship: |
          % if other_parties[0].has_foreign_citizenship:
          ${ other_parties[0].countries_of_citizenship }
          % endif
      - other_parties1_foreign_ids: |
          % if other_parties[0].has_foreign_citizenship:
          ${ other_parties[0].foreign_identity_documents }
          % endif
      - children0_name: ${ children.filter(legal_parent="both")[0].name.full() }
      - children0_sex: ${ "f" if children.filter(legal_parent="both")[0].gender == "female" else "m" }
      - children0_birthdate: ${ format_date(children.filter(legal_parent="both")[0].birthdate, format='M/d/yyyy') }
      - children0_age: |
          % if children.filter(legal_parent="both")[0].age_in_years() < 1:
          ${ children.filter(legal_parent="both")[0].age_in_months() } months
          % else:
          ${ children.filter(legal_parent="both")[0].age_in_years() }
          % endif
      - children0_ssn: ${ children.filter(legal_parent="both")[0].ssn }
      - children0_address_block: |
          % if children_now_live_with_which_parent == "both":
          See addendum for children's addresses.
          % elif children_now_live_with_which_parent == users[0] or (children_now_live_with_which_parent == "depends_on_child" and children.filter(legal_parent="both")[0].lives_with == users[0]):
          % if confidential_contact_info_yn:
          Confidential
          % else:
          ${ users[0].address.line_one() }
          ${ users[0].address.line_two() }
          % endif
          % elif children_now_live_with_which_parent == other_parties[0] or (children_now_live_with_which_parent == "depends_on_child" and children.filter(legal_parent="both")[0].lives_with == other_parties[0]):
          ${ other_parties[0].address.line_one() }
          ${ other_parties[0].address.line_two() }
          % endif
      # repeat up to children3 on this form, addendum message in children4 slot if needed
      #- stepchildren0_name:
      #- stepchildren0_sex:
      #- stepchildren0_birthdate:
      #- stepchildren0_age:
      #- stepchildren0_address_block:
      ## repeat once on this form, then addendum
      #- insurance_child_name0:
      #- insurance_policy_holder0:
      #- insurance_company_name0:
      #- insurance_policy_cert_group_number0:
      ## repeat up to insurance3, addendum message in insurance_child_name4 slot if needed
      - users1_signature: |
          % if MLH_esign:
          /s/ ${ users[0].name_full() }
          % else:
          ${ '' }
          % endif
      - signature_date: |
          % if MLH_esign:
          ${ signature_date }
          % else:
          ${ '' }
          % endif
      - pursuant_to: |
          % if MLH_esign:
          ${ MLH_esign_tag }
          % else:
          ${ '' }
          % endif
---
# --------------------------------------------------------------------
## Domestic Relations Verified Financial Information Form, CC 320
# --------------------------------------------------------------------
---
objects:
  - domestic_relations_verified_financial_cc_320: ALDocument.using(title="Domestic Relations Verified Financial Information Form - CC 320", filename="Domestic Relations Verified Financial Information Form - CC 320")
---
attachment:
  - name: Domestic Relations Verified Financial Information Form - CC 320
    filename: Domestic Relations Verified Financial Information Form - CC 320
    variable name: domestic_relations_verified_financial_cc_320[i]
    pdf template file: domestic_relations_verified_financial_info_cc320.pdf
    skip undefined: True
    editable: False
    fields:
      - trial_court_circuit: ${the_court.number}
      - docket_number: ${docket_number}
      - docket_number__1: ${docket_number}
      - docket_number__2: ${docket_number}
      - docket_number__3: ${docket_number}
      - docket_number__4: ${docket_number}
      - docket_number__5: ${docket_number}
      - docket_number__6: ${docket_number}
      # - judge_name: not used in divorce_complaint, will need to add for answers
      - plaintiffs0_name_full: ${plaintiffs[0].name_full()}
      - defendants0_name_full: ${defendants[0].name_full()}
      - users0_name_full: ${users[0].name_full()}
      - users0_phone_number: ${users[0].phone_number}
      - users0_address_on_one_line: ${users[0].address.on_one_line() if not confidential_contact_info_yn else ""}
      - users0_birthdate: ${users[0].birthdate}
      - users0_ssn: ${users[0].ssn}
      - users0_driver_license_and_state: ${ users[0].license_number + " " + users[0].license_state }
---
# --------------------------------------------------------------------
## Appplication for IV-D Child Support Services, DHS-1201D
# --------------------------------------------------------------------
---
objects:
  - child_support_services_dhs_1201d: ALDocument.using(title="Application for IV-D Child Support Services - DHS-1201D", filename="Application for IV-D Child Support Services - DHS-1201D")
---
attachment:
  - name: Application for IV-D Child Support Services - DHS-1201D
    filename: Application for IV-D Child Support Services - DHS-1201D
    variable name: child_support_services_dhs_1201d[i]
    pdf template file: child_support_services_dhs1201d.pdf
    skip undefined: True
    editable: False
    fields:
      - docket_number: ${docket_number}
      - relationship_mother: ${ True if users[0].gender == "female" and other_parties[0].gender == "male" else False }
      - relationship_father: ${ True if users[0].gender == "male" and other_parties[0].gender == "female" else False }
      - kids_live_with_mother: |
          % if users[0].gender == "male" and other_parties[0].gender == "female":
          ${ True if children_now_live_with_which_parent == other_parties[0] else False }
          % elif users[0].gender == "female" and other_parties[0].gender == "male":
          ${ True if children_now_live_with_which_parent == users[0] else False }
          % endif        
      - kids_live_with_father: |
          % if users[0].gender == "female" and other_parties[0].gender == "male":
          ${ True if children_now_live_with_which_parent == other_parties[0] else False }
          % elif users[0].gender == "male" and other_parties[0].gender == "female":
          ${ True if children_now_live_with_which_parent == users[0] else False }
          % endif     
      - kids_live_with_both: |
          ${ True if children_now_live_with_which_parent == "both" else False }
      - mothers1_name: |
          % if users[0].gender == "male" and other_parties[0].gender == "female":
          ${ other_parties[0] }
          % else:
          ${ users[0] }
          % endif        
      - mothers1_ssn: |
          % if users[0].gender == "male" and other_parties[0].gender == "female":
          ${ other_parties[0].ssn }
          % else:
          ${ users[0].ssn }
          % endif     
      - mothers1_address_on_one_line: |
          % if users[0].gender == "male" and other_parties[0].gender == "female":
          % if other_parties[0].mailing_address.yesno:
          ${ other_parties[0].mailing_address.on_one_line() }
          % else:
          ${ other_parties[0].address.on_one_line() }
          % endif
          % else:
          % if confidential_contact_info_yn:
          Confidential- Mailing Address: ${ users[0].address.on_one_line() }
          % elif users[0].mailing_address.yesno:
          ${ users[0].mailing_address.on_one_line() }
          % else:
          ${ users[0].address.on_one_line() }
          % endif
          % endif     
      - mothers1_phone_number: |
          % if users[0].gender == "male" and other_parties[0].gender == "female":
          ${ other_parties[0].phone_number }
          % else:
          ${ users[0].phone_number }
          % endif     
      - fathers1_name: |
          % if users[0].gender == "male" and other_parties[0].gender == "female":
          ${ users[0] }
          % else:
          ${ other_parties[0] }
          % endif     
      - fathers1_ssn: |
          % if users[0].gender == "male" and other_parties[0].gender == "female":
          ${ users[0].ssn }
          % else:
          ${ other_parties[0].ssn }
          % endif   
      - fathers1_address_on_one_line: |
          % if users[0].gender == "male" and other_parties[0].gender == "female":
          % if confidential_contact_info_yn:
          Confidential- Mailing Address: ${ users[0].address.on_one_line() }
          % elif users[0].mailing_address.yesno:
          ${ users[0].mailing_address.on_one_line() }
          % else:
          ${ users[0].address.on_one_line() }
          % endif
          % else:
          % if other_parties[0].mailing_address.yesno:
          ${ other_parties[0].mailing_address.on_one_line() }
          % else:
          ${ other_parties[0].address.on_one_line() }
          % endif
          % endif   
      - fathers1_phone_number: | 
          % if users[0].gender == "male" and other_parties[0].gender == "female":
          ${ users[0].phone_number }
          % else:
          ${ other_parties[0].phone_number }
          % endif   
      - confidential_contact_info_yes: ${ confidential_contact_info_yn }
      - confidential_contact_info_no: ${ True if not confidential_contact_info_yn else False }
      - permission_to_collect_overpayment_yes: ${ allow_child_support_overpayment_correction }
      - permission_to_collect_overpayment_no: ${ not allow_child_support_overpayment_correction }
      - collection_percentage_10: ${ allow_child_support_overpayment_correction and child_support_overpayment_percentage == "ten" }
      - collection_percentage_50: ${ allow_child_support_overpayment_correction and child_support_overpayment_percentage == "fifty" }
      - users1_signature: |
          % if MLH_esign:
          /s/ ${ users[0].name_full() }
          % else:
          ${ '' }
          % endif
      - users1_name: |
          % if MLH_esign:
          ${ users[0].name_full() }
          % else:
          ${ '' }
          % endif
      - signature_date: |
          % if MLH_esign:
          ${ signature_date }
          % else:
          ${ '' }
          % endif
      - pursuant_to: |
          % if MLH_esign:
          ${ MLH_esign_tag }
          % else:
          ${ '' }
          % endif
---
# --------------------------------------------------------------------
## Judgment CC-MLH-412 and Attachments
# --------------------------------------------------------------------
---
objects:
  - judgment_ccmlh412: ALDocument.using(title="Judgment", filename="Judgment.pdf", enabled=True, default_overflow_message=AL_DEFAULT_OVERFLOW_MESSAGE)
---
attachment:
  - name: Judgment ccmlh412 (no kids)
    filename: Judgment ccmlh412 (no kids)
    variable name: judgment_ccmlh412[i]
    pdf template file: judgment_ccmlh412_no_kids.pdf
    editable: False
    fields:
      - trial_court_circuit: |
          % if the_court.type == "circuit":
          ${the_court.number}
          % endif
      - docket_number: ${docket_number}
      - trial_court_county: ${the_court.address.county}
      - trial_court_address_on_one_line: ${the_court.address.on_one_line()}
      - trial_court_phone_number: ${ the_court.phone }
      - defendants_block: |
          ${defendants}
          ${defendants[0].address.on_one_line()}
          ${word("Does not have phone") if defendants[0].no_phone_number else defendants[0].phone_numbers()}
      - plaintiffs_block: |
          ${plaintiffs}
          ${plaintiffs[0].address.on_one_line()}
          ${word("Does not have phone") if plaintiffs[0].no_phone_number else plaintiffs[0].phone_numbers()}
      - plaintiffs1_name: ${plaintiffs}
      - defendants1_name: ${defendants}
      - spousal_support_none: Yes
      - spousal_support_reserved: No
      - spousal_support_awarded: No
      - personal_property_as_is: |
          ${not personal_property_in_addendum(marriage)}
      - personal_property_in_addendum: |
          ${personal_property_in_addendum(marriage)}
      - debts_none: ${not debts_in_addendum(marriage)}
      - debts_pay_debts_in_own_name: ${marriage.debts.any and marriage.attr("debts.pay_debts_in_own_names")}
      - debts_in_addendum: ${debts_in_addendum(marriage)}
      - vehicles_none: ${not marriage.vehicles.any}
      - vehicles_keep_same: ${marriage.vehicles.any and marriage.attr("vehicles.keep_own")}
      - vehicles_in_addendum: ${marriage.vehicles.any and not marriage.attr("vehicles.keep_own")}
      - real_property_none: ${not bool(marriage.real_property)}
      - real_property_in_addendum: ${bool(marriage.real_property)}
      - pensions_none: ${not marriage.have_pension_retirement}
      - pensions_keep_own: ${marriage.have_pension_retirement and marriage.attr("pension_retirement_accounts_keep_own")}
      - pensions_in_addendum: ${marriage.have_pension_retirement and not marriage.attr("pension_retirement_accounts_keep_own")}
      - total_pages: ""
      - wants_name_change: ${users[0].new_last_name_yn}
      - name_change_plaintiff: ${plaintiffs[0].attr("new_last_name_yn")}
      - name_change_defendant: ${defendants[0].attr("new_last_name_yn")}
      - new_name: ${users[0].attr("new_last_name")}
      - has_personal_property_debt_addendum: ${personal_property_in_addendum(marriage) or debts_in_addendum(marriage)}
      - has_vehicle_addendum: ${has_vehicle_addendum(marriage)}
      - has_real_property_addendum: ${bool(marriage.real_property)}
      - has_pension_addendum: ${marriage.have_pension_retirement and not marriage.attr("pension_retirement_accounts_keep_own")}
      - has_other_provisions: ${marriage.other_provisions_any}
      - other_provisions: ${marriage.attr("other_provisions")}
---
# The following functions are here so that the logic can be kept consistent,
# since these logical checks are used in multiple fields of the Judgment.
---
code: |
  def personal_property_in_addendum(marriage: DAObject) -> bool:
    return marriage.personal_property_acquired and (
      not marriage.attr("personal_property_division_agreement")
      or not marriage.attr("personal_property_division_actual")
    )
---
code: |
  def debts_in_addendum(marriage: DAObject) -> bool:
    return marriage.debts.any and (
      not marriage.attr("debts.agree_responsibility_debts_own_name")
      or marriage.attr("debts.any_in_both_names")
    )
---
code: |
  def has_vehicle_addendum(marriage: DAObject) -> bool:
    return (
      marriage.vehicles.any
      and not marriage.attr("vehicles.keep_own")
      and any(not item.agree for item in marriage.vehicles)
    )
---
