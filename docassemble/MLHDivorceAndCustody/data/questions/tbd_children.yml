# example date for testing
code: |
  marriage.date = "2015-07-20T00:00:00-04:00" 
---
# example interview tag for testing
code: |
  tool_ID = "divorce_complaint"
# other options = "divorce_complaint", "divorce_answer", "custody_complaint", "custody_answer"
---
code: |
  if tool_ID == "JOD_only" or tool_ID == "divorce_complaint" or tool_ID == "divorce_answer":
    OP_label = "your spouse"
  elif user_ask_role == "plaintiff":
    OP_label = "the defendant"
  elif user_ask_role == "defendant":
    OP_label = "the plaintiff"
---
### need the stuff in this section (copied from main yml) here for now to run just this yml
features:
  labels above fields: True
---
include:
  - docassemble.AssemblyLine:assembly_line.yml
  - docassemble.ALToolbox:collapse_template.yml
  - docassemble.mlhframework:mlh_interview_framework.yml
  - question_bank.yml
---
code: |
  github_repo_name = 'docassemble-MLHDivorceAndCustody'
---
### need the above for now to run just this yml
### below objects are not included in question bank yml
objects:
  - children: ALPeopleList.using(
      complete_attribute="complete",
      )
  - users[0].insurance: DAList.using(
      complete_attribute="complete",
      object_type = DAObject
      )
  - other_parties[0].insurance: DAList.using(
      complete_attribute="complete",
      object_type = DAObject
      )
  - prior_family_case_or_order: DAList.using(
      complete_attribute="complete",
      object_type = DAObject
      )
---
### possibly move the below to main yml
terms:
  - phrases:
      - assisted reproduction
    definition: |
      Assisted reproduction is a way to become pregnant that is not sexual intercourse. It includes:

      * Donor insemination
      * Sperm or egg donation
      * Embryo donation
      * In vitro fertilization (IVF) and embryo transfer
      * Intracytoplasmic sperm injection
      * Assisted reproductive technology
  - phrases:
      - parenting time
    definition: |
      Sometimes called "visitation".
  - phrases:
      - minor
    definition: |
      A child is a minor if they are 17 years old or younger.
      
---
table: children.table
rows: children
columns:
  - Name: row_item.name
  - Date of birth: row_item.birthdate
  - Entered family before or during marriage: |
      "before marriage" if row_item.timing == "premarital" else "during marriage"
edit:
  - name.first
  - timing
  - origin
  - bio_parent
  - parentage_established
  - legal_parent
  - not_included_in_divorce_info
  - parentage_revocation_info
  - complicated_issue_kickout
  - show_parentage_info # just for testing purposes
delete buttons: True
confirm: True
---
# trying using filter() method from https://docassemble.org/docs/objects.html
# if not, try using list comprehension something like "[child for child in children if child.legal_parent=="both"]"
id: child questions
mandatory: True # remove later
code: |
  children_intro
  children.gather()
  
  if children.there_are_any and len(children.filter(legal_parent="both")) > 0:
    
    if tool_ID == "divorce_complaint" or tool_ID == "divorce_answer":
      if not children_live_with_parent:
        children_live_with_third_party_kickout
      if kids_had_other_custodian:
        other_custodian_exit
      if third_party_custody_claim:
        third_party_custody_exit
      if temporary_order_exit:
        exit_general
  
    legal_custody_who
    if PT_type == "specific" or PT_type == "supervised":
      if county_choice == "Muskegon":
        Muskegon_specific_PT_info
      if county_choice != "Muskegon":
        specific_PT_how
      if county_choice == "Muskegon" or (county_choice != "Muskegon" and specific_PT_how == "custom"):
        custom_PT_details
    hague_convention_info
    child_domicile_info
    if legal_custody_who != "both":
      hundred_mile_rule
    child_support_basic
    users[0].insurance.gather()
    other_parties[0].insurance.gather()
    if users[0].insurance.there_are_any or other_parties[0].insurance.there_are_any:
      marriage.cobra_coverage
    interview_order_income_tax
    interview_order_prior_cases

  else:
    if tool_ID == "JOD_only" or tool_ID == "divorce_complaint" or tool_ID == "divorce_answer":
      marriage.cobra_coverage
    
  test_end_screen
---
code: |
  children[i].name.first
  children[i].timing 
  children[i].origin

  if children[i].origin == "marital_third_party_conceived" and children[i].how_conceived == "assisted_reproduction":
    children[i].complicated_issue_kickout
  
  children[i].legal_parent

  if children[i].legal_parent != "both":
    children[i].not_included_in_divorce_info
  
  elif ((children[i].origin == "premarital_with_another" and (children[i].parentage_established == "affidavit" or children[i].parentage_established == "court_order") and children[i].how_conceived == "sex") or (children[i].origin == "marital_third_party_conceived" and children[i].legal_parent == "both")) and children[i].parentage_plan_to_revoke:
    children[i].parentage_revocation_info

  elif children[i].origin == "premarital_with_another" and (children[i].parentage_established == "affidavit" or children[i].parentage_established == "court_order") and children[i].how_conceived == "assisted_reproduction":
    children[i].complicated_issue_kickout

  children[i].show_parentage_info

  children[i].complete = True
---
id: other_parties_0_gender
question: |
  What is your spouse's gender?
fields:
  - code: |
      other_parties[0].gender_fields(show_help=True)
---
id: users_0_pregnant
question: |
  Pregnancy
fields:
  - label: To the best of your knowledge are you pregnant?
    field: users[0].pregnant
    datatype: yesnoradio
---
id: other_parties_0_pregnant
question: |
  Pregnancy
fields:
  - label: To the best of your knowledge is your spouse pregnant?
    field: other_parties[0].pregnant
    datatype: yesnoradio
---
id: children intro
continue button field: children_intro
question: Children
subquestion: |
  This tool will ask questions about {minor} children next.

  ${ collapse_template(minor_children_info) }
  
  Important! If you and your spouse have a child **between 18 years old and 19 years and 6 months,** you may be able to ask for child support for that child, but this tool can’t help you with that.
  
  ${ collapse_template(adult_children_info) }
  
---
template: minor_children_info
subject: |
  More info about minor children and divorce
content: |
  If you and your spouse have any **minor children together**, your divorce must address custody, parenting time, and child support. 

  **Minor children of just one spouse** must also be listed in the divorce paperwork. However, the divorce will not cover their custody, parenting time, or child support.
---
template: adult_children_info
subject: |
  More info about children who are 18 to 19-and-a-half years old
content: |
  If you and your spouse have a **child between 18 years old and 19 years and 6 months**, it is possible to ask the court for child support if:

  * The child is enrolled full time in high school,
  * You reasonably expect the child to graduate, **and**
  * The child lives with one parent full time.

  If all of these things are true and you ask for child support, the judge **may** grant the request. It is not a guarantee. This can be complicated. If you want to ask for child support in this situation, you may want to talk to a lawyer. ${MLH_GUIDE_FULL} 
  
  You can make your divorce forms using this tool, but the forms **will not** include a child support request for your adult child.
---
if: tool_ID == "divorce_complaint"
id: any children divorce complaint
question: |
  Minor children
subquestion: |
  This includes stepchildren and children of just one of you.
fields:
  - Do you or your spouse have any living {minor} children? This includes children you had together and children you had separately.: children.there_are_any
    datatype: yesnoradio
---
if: tool_ID == "JOD_only"
id: any children JOD-only
question: |
  Minor children
subquestion: |
  Answer yes if there are:
  
  * any minor children who have you and your spouse as legal parents, or
  * any minor children of either spouse, and you're not sure who their legal parents are.
fields:
  - Do you and your spouse have any living {minor} children?: children.there_are_any
    datatype: yesnoradio
---
id: any more children
question: |
  Any more children?
subquestion: |
  % if tool_ID == "divorce_complaint":
  Please list **all minor children** that you or your spouse have, either separately or together.
  % elif tool_ID == "JOD_only":
  Please include:

  * all minor children who have you and your spouse as legal parents, and
  * all minor children of either spouse, if you're not sure who their legal parents are.
  % endif
  
  You have already told us about:

  ${children.table}
fields:
  - Are there any more minor children to add?: children.there_is_another
    datatype: yesnoradio
---
# Emily note: not sure if this is needed as it does not mirror Jack's patterns. It's possible it can be done in a different way. Cannot remember my thinking when I added it.
# alternatively, may need to add this for the other lists I create in this yml.
on change:
  children.there_are_any: |
    if not children.there_are_any:
      children.target_number = 0
      children.clear()
---
id: children info
sets:
  - children[i].name.first
  - children[i].name.middle
  - children[i].name.last
  - children[i].name.suffix
question: |
  ${ capitalize(ordinal(i)) } child's information
subquestion: |
  ${children.question_text_table_template}
fields:
  - code: |
      children[i].name_fields()
  - Date of birth: children[i].birthdate
    datatype: BirthDate
  - My spouse and I **adopted** this child together during our marriage.: children[i].adopted_during_marriage
    required: False
    datatype: yesno
  # need help text saying don't include children who were born to or adopted by either spouse prior to marriage
  - Gender: children[i].gender
    datatype: radio
    choices:
      - Female: female
      - Male: male
  - Social security number: ssn
    datatype: ssn
    required: False
---
code: |
  if children[i].adopted_during_marriage:
    children[i].timing = "marital"
    children[i].origin = "adoption"
  else:
    if int(date_difference(starting=marriage.date, ending=children[i].birthdate).days) < 0:
      children[i].timing = "premarital"
    elif int(date_difference(starting=marriage.date, ending=children[i].birthdate).days) > 0:
      children[i].timing = "marital"
---
if: not children[i].adopted_during_marriage and int(date_difference(starting=marriage.date, ending=children[i].birthdate).days) == 0
Question: Which was first?
fields:
  - Was ${children[i]} born before or after you got married?: children[i].timing
    datatype: radio
    choices: 
      - ${children[i]} was born before we got married.: premarital
      - ${children[i]} was born after we got married.: marital
---
id: marital children's origin
if: children[i].timing == "marital" and not children[i].adopted_during_marriage
question: |
  About ${children[i]}
fields:
  - Who gave birth to ${children[i]}?: children[i].marital_birth
    datatype: radio
    choices:
      - "**My spouse or I** gave birth to ${children[i]}.": True
      - "**Someone else** gave birth to ${children[i]}.": False
  - Which of these applies to ${children[i]}?: children[i].origin
    datatype: radio
    choices:
      - My spouse and I had ${children[i]} together through sex or assisted reproduction.: marital_sex_AR
      - My spouse or I had ${children[i]} with somebody else.: marital_third_party_conceived
    show if:
      variable: children[i].marital_birth 
      is: True
  - Which of these applies to ${children[i]}?: children[i].origin
    datatype: radio
    choices:
      - ${children[i]} was born through a surrogacy agreement.: marital_surrogacy
      - My spouse or I conceived ${children[i]} with someone else. That other person gave birth to ${children[i]}.: third_party_birth
    show if:
      variable: children[i].marital_birth
      is: False
  - note: |
      ${ collapse_template(why_ask_child_origin) }
      ${ collapse_template(help_assisted_repro) }
---
id: extramarital third party birth
if: children[i].timing == "marital" and children[i].origin == "third_party_birth"
question: ${children[i]}'s legal parent 
subquestion: ${ collapse_template(why_ask_child_origin) }
fields:
  - Who is ${children[i]}'s biological parent?: children[i].legal_parent
    datatype: radio
    choices:
      - I am.: user
      - My spouse is.: other_party
---
template: why_ask_child_origin
subject: |
  Why are you asking this?
content: |
  Depending on your answer, we may need to give you more information about parentage.
---
template: help_assisted_repro
subject: |
  What does "assisted reproduction" mean?
content: |
  Assisted reproduction is a way to become pregnant that is not sexual intercourse. It includes:
  
    * Donor insemination
    * Sperm or egg donation
    * Embryo donation
    * In vitro fertilization (IVF) and embryo transfer
    * Intracytoplasmic sperm injection
    * Assisted reproductive technology
---
id: adopted child set origin and legal parents
code: |
  if children[i].adopted_during_marriage:
    children[i].origin = "marital_adoption"
    children[i].legal_parent = "both"
---
id: set legal parents for certain situations
code: |
  if children[i].origin == "marital_sex_AR":
    children[i].legal_parent = "both"
  elif children[i].origin == "premarital_with_spouse" and children[i].how_conceived == "premarital_sex_or_assisted_repro_with_spouse" and (children[i].parentage_established == "yes" or (children[i].parentage_established == "unknown" and children[i].both_on_birth_cert == True)):
    children[i].legal_parent = "both"
  elif children[i].origin == "premarital_with_another" and children[i].parentage_established == "stepparent_adoption": 
    children[i].legal_parent = "both"
  elif children[i].origin == "premarital_with_another" and children[i].parentage_established == "no":
    children[i].legal_parent = children[i].bio_parent
  elif children[i].origin == "premarital_with_another" and (children[i].parentage_established == "affidavit" or children[i].parentage_established == "court_order") and children[i].how_conceived == "assisted_reproduction":
    children[i].legal_parent = "both"
  
---
id: premarital children's origin
if: children[i].timing == "premarital" 
question: |
  About ${children[i]}
fields:
  - Which of these applies to ${children[i]}?: children[i].origin
    datatype: radio
    choices:
      - My current spouse and I had ${children[i]} **together**.: premarital_with_spouse
        help: |
          This includes children conceived through sex, assisted reproduction, or a surrogacy agreement.
      - My current spouse or I had ${children[i]} **with someone else**.: premarital_with_another
        help: |
          This includes children who were conceived through sex, assisted reproduction, or a surrogacy agreement, or who were adopted.
      - My current spouse or I had ${children[i]} **alone**, through a **single-parent adoption** or through **assisted reproduction *without*** another parent.: premarital_alone
        help: |
          This answer is only for someone who became a single parent **on purpose** through:
          
          * adoption or 
          * assisted reproduction. 
          
          If there *was* another parent but they did not or could not act as a parent, choose a different answer.
  - How was ${children[i]} conceived?: children[i].how_conceived
    datatype: radio
    choices:
      - By sexual intercourse or assisted reproduction: premarital_sex_or_assisted_repro_with_spouse
      - Through a surrogacy agreement: premarital_surrogacy_with_spouse
    show if:
      variable: children[i].origin
      is: premarital_with_spouse
  - Who had ${children[i]} with someone else?: children[i].bio_parent
    datatype: radio
    choices:
      - I did.: user
      - My spouse did.: other_party
    show if:
      variable: children[i].origin
      is: premarital_with_another
  - note: |
      ${ collapse_template(why_ask_child_origin) }
      ${ collapse_template(help_assisted_repro) }
---
id: premarital children of sex, assisted repro
if: children[i].timing == "premarital" and children[i].origin == "premarital_with_spouse" and children[i].how_conceived == "premarital_sex_or_assisted_repro_with_spouse" and children[i].bio_parent == "user"
question: ${children[i]}'s legal parents 
subquestion: ${ collapse_template(why_ask_child_origin) }
fields:
  - Did your spouse become a legal parent of ${children[i]}?: children[i].parentage_established
    datatype: radio
    choices:
      - Yes: yes
      - No: no
      - I don't know.: unknown
  - note: |
      **Before you can use this tool** to get divorce forms, your spouse needs to become a legal parent so your divorce can include custody, parenting time, and child support for all children in common. To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    show if:
      variable: children[i].parentage_established
      is: no
  - Are both your and your spouse's names listed on ${children[i]}'s birth certificate as parents?: children[i].both_on_birth_cert
    datatype: yesnoradio
    show if: 
      variable: children[i].parentage_established
      is: unknown
  - note: |
      If your spouse is not listed on the birth certificate, this could mean either that:
      
      * you are the only legal parent, **or**
      * the birth certificate was not updated after your spouse became a legal parent. 
      
      Make sure that your spouse is a legal parent **before you use this tool** to get divorce forms. This is so your divorce can include custody, parenting time, and child support for all your children in common with your spouse. To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    show if:
      variable: children[i].both_on_birth_cert
      is: False
validation code: |
  if children[i].parentage_established == "no":
    validation_error("Both parents must become legal parents before you can use this tool to get divorce forms.", field="children[i].parentage_established")
  elif children[i].parentage_established == "unknown" and children[i].both_on_birth_cert == False:
    validation_error("Both parents must become legal parents before you can use this tool to get divorce forms.", field="children[i].both_on_birth_cert")
---
id: premarital children of sex, assisted repro
if: children[i].timing == "premarital" and children[i].origin == "premarital_with_spouse" and children[i].how_conceived == "premarital_sex_or_assisted_repro_with_spouse" and children[i].bio_parent == "other_party"
question: ${children[i]}'s legal parents 
subquestion: ${ collapse_template(why_ask_child_origin) }
fields:
  - Did you become a legal parent of ${children[i]}?: children[i].parentage_established
    datatype: radio
    choices:
      - Yes: yes
      - No: no
      - I don't know.: unknown
  - note: |
      **Before you can use this tool** to get divorce forms, you need to become a legal parent so your divorce can include custody, parenting time, and child support for all children in common. To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    show if:
      variable: children[i].parentage_established
      is: no
  - note: |
  - Are both your and your spouse's names listed on ${children[i]}'s birth certificate as parents?: children[i].both_on_birth_cert
    datatype: yesnoradio
    show if: 
      variable: children[i].parentage_established
      is: unknown
  - note: |
      If you are not listed on the birth certificate, this could mean either that:
      
      * your spouse is the only legal parent, **or** 
      * the birth certificate was not updated after you became a legal parent. 
      
      Make sure that you are a legal parent **before you use this tool** to get divorce forms. This is so your divorce can include custody, parenting time, and child support for all your children in common with your spouse. To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    show if:
      variable: children[i].both_on_birth_cert
      is: False
validation code: |
  if children[i].parentage_established == "no":
    validation_error("Both parents must become legal parents before you can use this tool to get divorce forms.", field="children[i].parentage_established")
  elif children[i].parentage_established == "unknown" and children[i].both_on_birth_cert == False:
    validation_error("Both parents must become legal parents before you can use this tool to get divorce forms.", field="children[i].both_on_birth_cert")
---
id: premarital solo child
if: children[i].origin == "premarital_alone"
question: About ${children[i]}
fields:
  - Who had ${children[i]} on their own before the marriage?: children[i].bio_parent
    datatype: radio
    choices:
      - I did.: user
      - My spouse did.: other_party
  - Did you become ${children[i]}'s legal parent through adoption, Affidavit of Parentage, or another court order (like a *Judgment of Parentage*)?: children[i].legal_parent
    datatype: radio
    choices:
      - Yes: both
      - No: other_party   # NOTE: does this work????   
    show if:
      variable: children[i].bio_parent
      is: other_party
  - Did your spouse become ${children[i]}'s legal parent through adoption, Affidavit of Parentage, or another court order (like a *Judgment of Parentage*)?: children[i].legal_parent
    datatype: radio
    choices:
      - Yes: both
      - No: user     # NOTE: does this work????   
    show if:
      variable: children[i].bio_parent
      is: user
---
id: surrogacy agreement compliance
if: (children[i].origin == "premarital_with_spouse" and children[i].how_conceived == "premarital_surrogacy_with_spouse") or children[i].origin == "marital_surrogacy"
question: Your surrogacy agreement for ${children[i]}
subquestion: ${ collapse_template(why_ask_child_origin) }
fields:
  - Did you have a lawyer to make sure your surrogacy agreement was legally valid?: children[i].legal_parent
    datatype: radio
    choices:
      - Yes: both
      - No: neither
  - note: |
      There may be issues about legal parentage in your divorce.  
      
      **Before you use this tool to get divorce forms, talk to a lawyer.** ${MLH_GUIDE_FULL} 
      
      To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    show if:
      variable: children[i].legal_parent
      is: neither
validation code: |
  if children[i].legal_parent == "neither": 
    validation_error("You need to talk to a lawyer to confirm the validity of your surrogacy agreement before continuing.")
---
id: premarital children with third party user is original parent
if: children[i].timing == "premarital" and children[i].origin == "premarital_with_another" and children[i].bio_parent == "user"
question: ${children[i]}'s legal parents 
subquestion: ${ collapse_template(why_ask_child_origin) }
fields:
  - Did your spouse become ${children[i]}'s legal parent?: children[i].parentage_established
    datatype: radio
    choices:
      - "**No**": no
      - Yes, they became ${children[i]}'s legal parent through **stepparent adoption**.: stepparent_adoption
      - Yes, they became ${children[i]}'s legal parent by an **Affidavit of Parentage.**: affidavit
      - Yes, they became ${children[i]}'s legal parent by a **court order** of parentage (for example, an *Order of Filiation* or a *Judgment of Parentage*).: court_order
  - How was ${children[i]} conceived?: children[i].how_conceived
    datatype: radio
    choices:
      - By sexual intercourse: sex   # trigger revocation questions and message
      - By assisted reproduction: assisted_reproduction # trigger complicated issue kickout
    js show if: |
      val("children[i].parentage_established") == "affidavit" || val("children[i].parentage_established") == "court_order"
---
id: premarital children with third party spouse is original parent
if: children[i].timing == "premarital" and children[i].origin == "premarital_with_another" and children[i].bio_parent == "other_party"
question: ${children[i]}'s legal parents 
subquestion: ${ collapse_template(why_ask_child_origin) }
fields:
  - Did you become ${children[i]}'s legal parent?: children[i].parentage_established
    datatype: radio
    choices:
      - "**No**": no
      - Yes, I became ${children[i]}'s legal parent through **stepparent adoption**.: stepparent_adoption
      - Yes, I became ${children[i]}'s legal parent by an **Affidavit of Parentage.**: affidavit
      - Yes, I became ${children[i]}'s legal parent by a **court order** of parentage (for example, an *Order of Filiation* or a *Judgment of Parentage*).: court_order
  - How was ${children[i]} conceived?: children[i].how_conceived
    datatype: radio
    choices:
      - By sexual intercourse: sex   # trigger revocation questions and message
      - By assisted reproduction: assisted_reproduction # trigger complicated issue kickout
    js show if: |
      val("children[i].parentage_established") == "affidavit" || val("children[i].parentage_established") == "court_order"
---
id: parentage revocation questions, user is bio parent
if: ((children[i].origin == "premarital_with_another" and (children[i].parentage_established == "affidavit" or children[i].parentage_established == "court_order") and children[i].how_conceived == "sex") or (children[i].origin == "marital_third_party_conceived")) and children[i].bio_parent == "user"
Question: Legal parentage status for ${children[i]}
fields:
  - Has your spouse's parentage been revoked (canceled) by a court order? This would only happen if you, your spouse, or ${children[i]}’s other biological parent filed a complaint or motion to revoke parentage, and the judge granted it.: children[i].legal_parent
    datatype: radio
    choices:
      - Yes: user
      - No: both
  - Do you want to ask the court to revoke (cancel) your spouse's legal parentage of ${children[i]} as part of your divorce case?: children[i].parentage_plan_to_revoke
    datatype: radio
    choices:
      - Yes, I want to ask the court to revoke my spouse's parentage.: True
      - No, I want my spouse to continue as legal parent.: False
    js show if: |
      val("children[i].legal_parent") == "both"
---
id: parentage revocation questions, spouse is bio parent
if: ((children[i].origin == "premarital_with_another" and (children[i].parentage_established == "affidavit" or children[i].parentage_established == "court_order") and children[i].how_conceived == "sex") or (children[i].origin == "marital_third_party_conceived")) and children[i].bio_parent == "other_party"
Question: Legal parentage status for ${children[i]}
fields:
  - Has your parentage been revoked (canceled) by a court order? This would only happen if you, your spouse, or ${children[i]}’s other biological parent filed a complaint or motion to revoke parentage, and the judge granted it.: children[i].legal_parent
    datatype: radio
    choices:
      - Yes: other_party
      - No: both
  - Do you want to ask the court to revoke (cancel) your legal parentage of ${children[i]} as part of your divorce case?: children[i].parentage_plan_to_revoke
    datatype: radio
    choices:
      - Yes, I want to ask the court to revoke my parentage.: True
      - No, I want to continue as legal parent.: False
    js show if: |
      val("children[i].legal_parent") == "both"
---
id: info about revoking parentage
if: ((children[i].origin == "premarital_with_another" and (children[i].parentage_established == "affidavit" or children[i].parentage_established == "court_order") and children[i].how_conceived == "sex") or (children[i].origin == "marital_third_party_conceived" and children[i].legal_parent == "both")) and children[i].parentage_plan_to_revoke
continue button field: children[i].parentage_revocation_info
question: Information about revoking parentage
subquestion: |
  % if children[i].origin == "premarital_with_another":
  
  % if children[i].parentage_established == "affidavit":
  
  % if children[i].bio_parent == "other_party":
  To do this, you can file a [Complaint/Motion and Affidavit to Revoke Acknowledgment of Parentage](https://www.courts.michigan.gov/49302a/siteassets/forms/scao-approved/cc435_new.pdf) along with the forms you file to start your divorce case. You may want to consider finding a lawyer to help you.
      
  If the judge revokes your parentage before your divorce is final, you will need to update the Judgment of Divorce before presenting it to the judge. You can do this by returning to this tool and changing your answer to the question that asks if parentage of ${children[i]} was revoked, then re-downloading the Judgment of Divorce form.
  
  % elif children[i].bio_parent == "user":
  To do this, you can file a [Complaint/Motion and Affidavit to Revoke Acknowledgment of Parentage](https://www.courts.michigan.gov/49302a/siteassets/forms/scao-approved/cc435_new.pdf) along with the forms you file to start your divorce case. You may want to consider finding a lawyer to help you.
      
  If the judge revokes your spouse's parentage before your divorce is final, you will need to update the Judgment of Divorce before presenting it to the judge. You can do this by returning to this tool and changing your answer to the question that asks if parentage of ${children[i]} was revoked, then re-downloading the Judgment of Divorce form.
  % endif

  % elif children[i].parentage_established =="court_order":
  
  % if children[i].bio_parent == "other_party":
  To do this, you can file a [Motion to Set Aside Order of Filiation](https://www.courts.michigan.gov/4a8194/siteassets/forms/scao-approved/cc437.pdf) in the same case that the Order of Filiation was entered in. You may want to consider finding a lawyer to help you.
  
  If the judge revokes your parentage before your divorce is final, you will need to update the Judgment of Divorce before presenting it to the judge. You can do this by returning to this tool and changing your answer to the question that asks if parentage of ${children[i]} was revoked, then re-downloading the Judgment of Divorce form.

  % elif children[i].bio_parent == "user":
  To do this, file a [Motion to Set Aside Order of Filiation](https://www.courts.michigan.gov/4a8194/siteassets/forms/scao-approved/cc437.pdf) in the same case that the Order of Filiation was entered in. You may want to consider finding a lawyer to help you.

  If the judge revokes your spouse’s parentage before your divorce is final, you will need to update the Judgment of Divorce before presenting it to the judge. You can do this by returning to this tool and changing your answer to the question that asks if parentage of ${children[i]} was revoked, then re-downloading the Judgment of Divorce form.
  % endif
  % endif
  
  % elif children[i].origin == "marital_third_party_conceived":
  
  % if children[i].bio_parent == "other_party":
  If the judge revokes your parentage before your divorce is final, you will need to update the Judgment of Divorce before presenting it to the judge. You can do this by returning to this tool and changing your answer to the question that asks if parentage of ${children[i]} was revoked, and then re-downloading the Judgment of Divorce form.

  You, your spouse, or the child's other biological parent can file a motion as part of your divorce case asking the judge to revoke (undo) your legal parentage. To prepare this motion, use the [Do-It-Yourself Revoke Parentage Established by Marriage tool](https://michiganlegalhelp.org/resources/family/do-it-yourself-revoke-parentage-established-marriage). You will need to start the divorce case before you can file the parentage motion.

  If nobody files a Motion to Determine Child Born Out of Wedlock, you will remain a legal parent. This means the judge can award you custody and/or parenting time, and you may be responsible for paying child support. A motion to revoke parentage can also be filed after your divorce is final, but the judge may be less likely to grant the motion when the child is older. To learn more, go to the page that applies to you on the Michigan Legal Help website: [Revoking Marriage-Based Parentage: For the Mother or Birthing Parent](https://michiganlegalhelp.org/resources/family/revoking-marriage-based-parentage-mother-or-birthing-parent), or [Revoking Marriage-Based Parentage: For the Husband or Spouse](https://michiganlegalhelp.org/resources/family/revoking-marriage-based-parentage-husband-or-spouse).
  
  % elif children[i].bio_parent == "user":
  If the judge revokes your spouse's parentage before your divorce is final, you will need to update the Judgment of Divorce before presenting it to the judge. You can do this by returning to this tool and changing your answer to the question that asks if parentage of ${children[i]} was revoked, and then re-downloading the Judgment of Divorce form.

  You, your spouse, or the child's other biological parent can file a motion as part of your divorce case asking the judge to revoke (undo) your spouse's legal parentage. To prepare this motion, use the [Do-It-Yourself Revoke Parentage Established by Marriage tool](https://michiganlegalhelp.org/resources/family/do-it-yourself-revoke-parentage-established-marriage). You will need to start the divorce case before you can file the parentage motion.

  If nobody files a Motion to Determine Child Born Out of Wedlock, your spouse will remain a legal parent. This means the judge can award them custody and/or parenting time, and they may be responsible for paying child support. A motion to revoke parentage can also be filed after your divorce is final, but the judge may be less likely to grant the motion when the child is older. To learn more, go to the page that applies to you on the Michigan Legal Help website: [Revoking Marriage-Based Parentage: For the Mother or Birthing Parent](https://michiganlegalhelp.org/resources/family/revoking-marriage-based-parentage-mother-or-birthing-parent), or [Revoking Marriage-Based Parentage: For the Husband or Spouse](https://michiganlegalhelp.org/resources/family/revoking-marriage-based-parentage-husband-or-spouse).
  % endif
  % endif
---
id: info about nonmarital children
if: children[i].legal_parent != "both"
continue button field: children[i].not_included_in_divorce_info
question: Important!
subquestion: |
  % if children[i].legal_parent == "other_party":
  Because you are not ${children[i]}'s legal parent, ${children[i].familiar()} can't be included in the custody, parenting time, and child support sections of your judgment of divorce (final divorce order). 

    If you are concerned about your ability to be a part of ${children[i].familiar()}'s life, talk to a lawyer. ${MLH_GUIDE_FULL}
  % elif children[i].legal_parent == "user":
  Because your spouse is not ${children[i]}'s legal parent, ${children[i].familiar()} can't be included in the custody, parenting time, and child support sections of your judgment of divorce (final divorce order). 
  % endif
---
id: kickout for complex situations involving assisted reproduction
if: ((children[i].origin == "premarital_with_another" and (children[i].parentage_established == "affidavit" or children[i].parentage_established == "court_order")) or children[i].origin == "marital_third_party_conceived") and children[i].how_conceived == "assisted_reproduction"
event: children[i].complicated_issue_kickout
question: This tool is not right for you
subquestion: |
  We're sorry. You can't use this tool to make divorce forms. 
  
  Legal parentage of ${children[i]} may be a complicated issue in your divorce. You will need to find a lawyer to help you. ${MLH_GUIDE_FULL}
---
id: who is birth parent
if: (children[i].origin == "premarital_with_spouse" and children[i].how_conceived == "premarital_sex_or_assisted_repro_with_spouse") or children[i].origin == "marital_third_party_conceived"
question: ${children[i]}'s birth parent
subquestion: |
  ${ collapse_template(why_ask_child_origin) }
fields:
  - Who gave birth to ${children[i]}?: children[i].bio_parent
    datatype: radio
    choices:
      - I did.: user
      - My spouse did.: other_party
  - How was ${children[i]} conceived?: children[i].how_conceived
    datatype: radio
    choices:
      - By sexual intercourse: sex   # trigger revocation questions and message
      - By assisted reproduction: assisted_reproduction # trigger complicated issue kickout
    js show if: |
      (val("children[i].bio_parent") == "user" || val("children[i].bio_parent") == "other_party") && ${ json.dumps(children[i].origin) } === "marital_third_party_conceived"
---
id: display parentage interview for testing purposes
question: Parentage Result
continue button field: children[i].show_parentage_info
subquestion: |
  ${children[i]}'s legal parents is/are:

  % if children[i].legal_parent == "both":
  **Both** the user and their spouse. (Custody, etc., will be decided in the divorce.)
  % elif children[i].legal_parent == "user":
  **Only the user**. (${children[i].familiar()} will be listed as a stepchild only.)
  % elif children[i].legal_parent == "other_party":
  **Only the user's spouse**. 
  
  (${children[i].familiar()} will be listed as a stepchild only.)
  % endif

  origin code: ${children[i].origin}
  
  timing code: ${children[i].timing}
---
######## start children qualification/address/home state questions #######
# LHI "(Marital) Minor Children Information" (first part)
id: where children live
question: |
  % if len(children.filter(legal_parent="both")) > 1:
  Who your minor children live with now
  % else:
  Who ${ children[0] } lives with now
  % endif
subquestion: |
  This question is about your and ${ other_parties[0] }'s shared minor ${ children.as_noun() }: ${ comma_and_list(children.filter(legal_parent='both')) }.

  This question does not include stepchildren, or legal children of just one of you.
fields:
  - label: |
      % if len(children.filter(legal_parent="both")) > 1:
      Do all of your and ${ other_parties[0] }'s minor children currently live with you or ${ other_parties[0] }?
      % else:
      Does your child ${ children[0] } currently live with you or ${ other_parties[0] }?
      % endif
    field: children_live_with_parent
    datatype: yesnoradio
  - label: |
      % if len(children.filter(legal_parent="both")) > 1:
      Who do your and ${ other_parties[0] }'s minor children currently live with?
      % else:
      Who does your child ${ children[0] } currently live with?
      % endif
    field: which_parent_lives_with_children
    datatype: radio
    code: |
      child_lives_with_choices
    show if:
      variable: children_live_with_parent
      is: True
---
# TODO: going to have to clear this out and rebuild if # of children changes
code: |
  child_lives_with_choices = [
                  ['users[0]', 'Me'],
                  ['other_parties[0]', 'My spouse'],
                  ['both', 'Both']
                             ]
  
  if len(children.filter(legal_parent="both")) > 1:
    tax_choices.append(['specify_per_child', f'{ users[0] } and { other_parties[0] } will claim the deductions, credits, and exemptions for different children, including state, federal, or local tax returns.'])
  
  child_lives_with_choices.append(['depends_on_child', 'One or more children live with me, and one or more children live with my spouse.'])
---
id: kickout if children don't live with parents
event: children_live_with_third_party_kickout
question: This tool is not right for you
subquestion: |
  We're sorry. You cannot use this tool if any of your shared minor children are living with someone besides you or your spouse.
  
  You may want to speak with a lawyer. ${MLH_GUIDE_FULL}
---
id: children disqualifiers
question: |
  Minor children -- special situations
subquestion: |
  These questions are about your and ${ other_parties[0] }'s shared minor ${ children.as_noun() }: ${ comma_and_list(children.filter(legal_parent='both')) }.

  These question are not about stepchildren, or legal children of just one of you.
fields:
  - label: |
      % if len(children.filter(legal_parent="both")) > 1:
      Have any of your and ${ other_parties[0] }'s children lived with a legal custodian, other than a parent, during the past five years? (For example, because of a child protective services case, a minor guardianship, or a third-party custody order.)
      % else:
      Has your child ${ children[0] } lived with a legal custodian, other than a parent, during the past five years? (For example, because of a child protective services case, a minor guardianship, or a third-party custody order.)
      % endif
    field: kids_had_other_custodian
    datatype: yesnoradio
  - label: |
      % if len(children.filter(legal_parent="both")) > 1:
      Are there any other adults (besides you and your spouse) who may have a legal right to custody or parenting time of any of the minor children?
      % else:
      Are there any other adults (besides you and your spouse) who may have a legal right to custody or parenting time of any of ${ children[0] }?
      % endif
    show if:
      variable: kids_had_other_custodian
      is: False
    field: third_party_custody_claim
    datatype: yesnoradio
  - label: |
      % if len(children.filter(legal_parent="both")) > 1:
      Do you believe that a temporary custody order is needed to protect the children because they have been abused, mistreated, threatened, or neglected?
      % else:
      Do you believe that a temporary custody order is needed to protect ${ children[0] } because they have been abused, mistreated, threatened, or neglected?
      % endif
    show if:
      variable: third_party_custody_claim
      is: False
    field: need_temporary_order
    datatype: yesnoradio
  - note: |
      **WARNING! This tool may not be right for you.** Getting temporary orders for custody is not simple. Neither this tool nor the Michigan Legal Help website will create temporary orders. **The forms created by this tool will not let the judge know that a temporary order is needed or that the children in this case have been abused, mistreated, threatened, or neglected.**

      You can still use this tool to prepare your forms and begin the divorce process, but this tool will not create any motions for temporary custody orders or proposed temporary custody orders. You may want to consider hiring a lawyer to help you ask the judge for a temporary custody order.

      ${MLH_GUIDE_FULL} 
    show if:
      variable: need_temporary_order
      is: True
  - Do you want to continue?: temporary_order_exit
    datatype: noyesradio
    show if:
      variable: need_temporary_order
      is: True
---
######## start custody questions #######
---
id: custody parenting time questions
question: |
  Custody and Parenting Time
subquestion: | 
  ${ collapse_template(custody_PT_guidance, collapsed=False) }
fields:
  - Who should have legal custody?: legal_custody_who
    datatype: radio
    choices:
      - Only me: user
      - Only my spouse: other_party
      - "Both of us, jointly": both
  - Who should have physical custody?: physical_custody_who
    datatype: radio
    choices:
      - Only me: user
      - Only my spouse: other_party
      - "Both of us, jointly": both
  - note: |
      Because you have selected joint physical custody, both parents will have parenting time.
    show if: 
      variable: physical_custody_who
      is: both
  - Who should have parenting time (visitation) with the children?: PT_who
    datatype: radio
    choices: 
      - Only me: user
      - Both of us: both
    show if:
      variable: physical_custody_who
      is: user
  - Who should have parenting time (visitation) with the children?: PT_who
    datatype: radio
    choices: 
      - Only my spouse: other_party
      - Both of us: both
    show if:
      variable: physical_custody_who
      is: other_party
  - What type of parenting time do you believe is appropriate?: PT_type
    datatype: radio
    choices:
      - Reasonable: reasonable
      - Specific: specific
    js show if: |
      val("PT_who") == "both" || val("physical_custody_who") == "both"
  - What type of parenting time do you believe is appropriate?: PT_type
    datatype: radio
    choices:
      - Reasonable: reasonable
      - Specific: specific
      - Specific and supervised: supervised
    js show if: |
      val("PT_who") == "both" && val("physical_custody_who") != "both"
  - label: "If you know the name of the person or agency you want to supervise parenting time, enter it here. If you don't know, leave this blank."
    field: PT_supervisor
    show if: 
      variable: PT_type
      is: supervised
    required: False
  - note: |
      ${ collapse_template(custody_PT_definitions) }
---
if: (PT_type == "specific" or PT_type == "supervised") and county_choice != "Muskegon"
id: specific parenting time options
question: |
  Specific Parenting Time Schedules
subquestion: | 
  You will need a specific parenting time schedule. If you are able to work with the other parent, you may want to come up with the schedule together.

  The [Michigan Parenting Time Guideline](https://www.courts.michigan.gov/4a537f/siteassets/court-administration/standardsguidelines/foc/pt_gdlns.pdf), created by the Friend of the Court Bureau, is a helpful resource for putting together a parenting time schedule. We recommend that you **review the Guideline before** creating a custom parenting time schedule for your family. 

  ${ collapse_template(MI_PT_guideline_info) }

  You may also be able to get a sample schedule from your county's Friend of the Court (FOC) office. Check their website or ask the Friend of the Court how to get one. 
  
  % if not user_logged_in():
  If you need time to come up with a schedule, please create an account and sign in to save your answers for later.
  % endif
  
fields:
  - Do you want to write your own parenting time schedule or use a sample schedule?: specific_PT_how
    datatype: radio
    choices:
      - Write my own: custom
      - "Use a sample schedule from my county’s Friend of the Court office (If you choose this option, you can either find the schedule on your court website or ask the Friend of the Court how to get one).": FOC_sample

---
if: (PT_type == "specific" or PT_type == "supervised") and county_choice == "Muskegon"
id: specific parenting time info
continue button field: Muskegon_specific_PT_info
question: |
  Specific Parenting Time Schedules
subquestion: | 
  You will need a specific parenting time schedule. If you are able to work with the other parent, you may want to come up with the schedule together.

  The [Michigan Parenting Time Guideline](https://www.courts.michigan.gov/4a537f/siteassets/court-administration/standardsguidelines/foc/pt_gdlns.pdf), created by the Friend of the Court Bureau, is a helpful resource for putting together a parenting time schedule. We recommend that you **review the Guideline before** creating a custom parenting time schedule for your family. 

  ${ collapse_template(MI_PT_guideline_info) }

  % if not user_logged_in():
  If you need time to come up with a schedule, please create an account and sign in to save your answers for later.
  % endif
---
template: MI_PT_guideline_info
subject: |
  More information about the Michigan Parenting Time Guideline
content: |
  The [Michigan Parenting Time Guideline](https://www.courts.michigan.gov/4a537f/siteassets/court-administration/standardsguidelines/foc/pt_gdlns.pdf) includes sample schedules you can use as a starting place to create your family's schedule. It also has information about the developmental needs of children at different ages in connection to parenting time. The Guideline addresses specific topics such as long distance parenting time, parenting time with a parent who is in prison, and domestic violence situations.
---
template: custody_PT_guidance
subject: |
  How to answer the custody and parenting time questions:
content: |
  % if tool_ID == "JOD_only":
  
  1. If the **judge issued temporary orders** for custody or {parenting time}, you should match the judge's orders.
  
  2. If there are **no temporary orders** for custody or {parenting time}:
      * if you and your spouse **agree** on a question, use your agreed answer.
      * if you and your spouse **don't agree** on a question, use the custody and parenting time terms that you want the judge to order.
  
  % elif tool_ID == "divorce_complaint":
  * If you and your spouse **agree** on a question, use your agreed answer.
  * If you and your spouse **don't agree** on a question, use the custody and parenting time terms that you want the judge to order.

  You may have to come back to this tool later and change the custody and parenting time terms if you and your spouse change your agreement or if the judge orders terms that are different than those you enter now.  
  % if not user_logged_in():
  You must create an account and log in to save your answers.
  % endif
  % endif
---
template: custody_PT_definitions
subject: |
  What do these questions mean?
terms:
  noncustodial parent: |
    The "**noncustodial parent**" is the parent who does **not** have sole or primary physical custody of the children. 
    
    The "custodial parent" generally refers to the parent with whom the children live most of the time.
  
content: |
  ===== **Legal Custody** =====
  
  Having legal custody of your children means having the right to make important decisions about their lives, like where they go to school, what religion they are, and major medical decisions. Either parent can have sole legal custody, or parents can have joint legal custody. 
  
  When parents have joint legal custody, they both have the right to weigh in on important decisions about their kids. Both parents must agree on important decisions. If they can’t agree, they may have to ask the judge to decide. 
  
  If a parent has sole legal custody, that parent can make these important decisions without the other parent’s agreement.

  ===== **Physical Custody** =====
  
  Having physical custody of your children means your children will live with you at least some of the time. Either parent can have sole physical custody, or parents can have joint physical custody. 
  
  When parents have joint physical custody, the children take turns living with each parent. 
  
  If one parent has sole physical custody, the other parent will usually have regular parenting time, or “visitation,” with the children.

  ===== **Parenting Time Types** =====
  
  **Reasonable**: If a judge orders “reasonable” parenting time, specific dates, times, and other conditions are left for the parents to work out. If you believe that you and your spouse can agree on parenting time arrangements, you may ask for reasonable parenting time rather than a specific parenting time schedule. However, if the judge orders reasonable parenting time, and you and your spouse can’t agree, the judge may not be able to enforce the order or judgment. You will need to return to court and ask for a specific parenting time schedule in order for the judge to enforce the judgment.

  **Specific**: If a judge orders “specific” parenting time, all of the dates, times, and conditions for visits are included in the court order. Many counties have standard parenting time schedules that you can use in your case. You can contact the Friend of the Court in the county where your case will be filed and ask if there is a standard parenting time schedule. You can also choose one of our common parenting time schedules for families that have joint physical custody, for families with school-age children, for families with children younger than school age, or for long distance parenting time of school-age children.

  **Specific and supervised**: If a judge orders “specific and supervised” parenting time, all of the dates, times, and conditions for visits are included in the court order. The judge will order parenting time to be supervised by a third party – such as a relative, friend, or supervised parenting time center. Supervised parenting time may be appropriate if the {noncustodial parent} is a risk to the children. The supervisor must be willing to supervise parenting time.

---
id: custom parenting time schedule
if: county_choice == "Muskegon" or (county_choice != "Muskegon" and specific_PT_how == "custom")
question: Parenting Time Schedule
subquestion: |
  What parenting time schedule do you want the judge to order?
  
   - Write in complete sentences and include all important details, including days and times.
   - Refer to yourself and your spouse by your full names, or as Plaintiff and Defendant.
   - Do **not** use words like “I”, “we”, “him”, or “her”.

  Review the [Michigan Parenting Time Guideline](https://www.courts.michigan.gov/4a537f/siteassets/court-administration/standardsguidelines/foc/pt_gdlns.pdf) for help creating a schedule that fits your family’s needs. 
fields:
  - label: "Your parenting time schedule:"
    field: custom_PT_details
    input type: area
    rows: 10
---
id: Hague Convention warning
continue button field: hague_convention_info
question: Parenting Time in a Foreign Country and the Hague Convention
subquestion: |
  The Hague Convention is a treaty that helps parents get a kidnapped child back from other countries that have agreed to the treaty. [Countries that are treaty partners](https://travel.state.gov/content/travel/en/International-Parental-Child-Abduction/abductions/hague-abduction-country-list.html) have agreed to return a child who has been taken to or kept in another Hague country in violation of a parent's custodial rights.

  An abducted child is returned to where the child was a **habitual resident.** This means the country where the child has been living. It doesn’t necessarily mean the country where the child or the child’s parents are citizens. After the child is returned to the country of habitual residence, custody decisions are made in the courts there. The Hague Convention does not decide who should have custody of the child. It only decides where the custody case will happen.

  It can be much harder to return a kidnapped child from a country that has not signed on to the Hague Convention. Because of this, Michigan law requires your Judgment of Divorce to include a paragraph that prevents parenting time in a non-Hague Convention country. The Judgment includes a place where you and your spouse can agree to allow parenting time in a specific country that is not a Hague Convention country, but you cannot do this using this tool.

  The Hague Convention is complicated, and it is an important tool for a parent whose spouse abducts their child and keeps the child in another country. If you want your spouse to have parenting time in a country that is **not** a party to the Hague Convention, you may want to consider talking to a lawyer to make sure you understand the risks involved.

---
# LHI Domicile and Residence of Minor Children Part 1
id: generic domicile provisions
continue button field: child_domicile_info
question: Domicile and Residence of Minor Children 
subquestion: |
  If your Judgment of Divorce has custody provisions, the following will apply:

  % if len(children.complete_elements()) > 1:
  * If you have sole or joint physical custody of your children and you move, you must give the Friend of the Court the child’s new address in writing.
  * The minor children may not be moved from the state of Michigan without the judge’s prior approval. Even if you and your spouse agree that the children can move out of state, you must get a court order first.
  * Neither you nor your spouse may move more than 100 miles away from where you lived at the beginning of the case (within Michigan) except in certain situations. This is called the “100-mile rule.” **If one parent is granted sole legal custody of the minor children, the 100-mile rule will not apply.**
  % else:
  * If you have sole or joint physical custody of your child and you move, you must give the Friend of the Court the child’s new address in writing.
  * The minor child may not be moved from the state of Michigan without the judge’s prior approval. Even if you and your spouse agree that the child can move out of state, you must get a court order first.
  * Neither you nor your spouse may move more than 100 miles away from where you lived at the beginning of the case (within Michigan) except in certain situations. This is referred to as the “100-mile rule.” **If one parent is granted sole legal custody of the minor child, the 100-mile rule will not apply.**
  % endif

---
# LHI Domicile and Residence of Minor Children Part 2
id: 100 mile rule
continue button field: hundred_mile_rule
question: 100-Mile Rule
fields:
  - Do you and your spouse currently live more than 100 miles away from each other?: already_over_100_miles
    datatype: yesnoradio
  - note: |
      **The 100-mile rule will not apply in your case** because you and your spouse live more than 100 miles away from each other at the start of your divorce case. 
    show if:
      variable: already_over_100_miles
      is: True
  - "Do you and your spouse agree that either of you may move more than 100 miles from where you currently live, as long as you still live within the state of Michigan?": allow_over_100_miles
    datatype: yesnoradio
    show if:
      variable: already_over_100_miles
      is: False
  - note: |
      **The 100-mile rule will not apply in your case** if you and your spouse agree that it will not apply. 
    show if:
      variable: allow_over_100_miles
      is: True
  - note: |
      According to your answers, the minor child will have a legal residence with each parent, (meaning you and your spouse will be granted joint legal custody), and **the 100-mile rule will apply in your case.** 
      
      Your Judgment of Divorce will state that “neither party shall move more than 100 miles away from where he or she lived at the beginning of this case, and the child has a legal residence with each parent. For more information, read [Moving with Children After Separation or Divorce](https://michiganlegalhelp.org/resources/family/moving-children-after-separation-or-divorce).
    show if:
      variable: allow_over_100_miles
      is: False
---
# LHI Child Support
id: child support basic info
continue button field: child_support_basic
question: Child Support
subquestion: |
  % if tool_ID == "divorce_complaint":
  Your Complaint for Divorce will ask the judge to order child support. 
  % endif
  Michigan law requires judges to order child support based on the Michigan Child Support Formula. In many counties, the Friend of the Court will calculate child support for you. The amount of child support is based on the income of each parent, the number of overnights that each parent has with the child, and a number of other factors. You can use the [MiChildSupport Calculator](https://micase.state.mi.us/calculatorapp/public/welcome/load.html) on the Michigan Department of Health and Human Services website to find out what the support amount might be in your case.

  In some situations, the judge can order support that is less than what is required by the Michigan Child Support Formula, or order no child support at all—but this is uncommon. If you think there is a reason to have less child support than required by the Formula or none at all, you may want to contact a lawyer. ${MLH_GUIDE_FULL} 
  
  To learn more about child support, read [Child Support in a Nutshell](https://michiganlegalhelp.org/resources/family/child-support-nutshell).
---
# LHI Child Support Part 2
# note: do not include in JOD-only, but do include in other 4 tools
id: child support errors
question: Child support processing errors
subquestion: |
  If you end up **receiving** child support, the Michigan IV-D child support program will process the payments. If an error is made and you receive money that you were not owed or you are overpaid, the program will take steps to correct the error.
fields:
  - Do you want to give the program permission to pay back any error or overpayment by keeping a percentage from your future child support payments until the mistake is corrected?: allow_child_support_overpayment_correction
    datatype: yesnoradio
  - note: |
      ${ collapse_template(child_support_overpayment_correction_info) }  
  - "If an error is made, what percentage do you permit the child support program to withhold from your payments until the error is corrected?": child_support_overpayment_percentage
    datatype: radio
    choices:
      - 10%: ten
      - 20%: twenty
      - 30%: thirty
    show if:
      variable: allow_child_support_overpayment_correction
      is: True
---
template: child_support_overpayment_correction_info
subject: |
  More information
content:
  Select "No" if you would like to be contacted before the child support program tries to recover an amount from your support payments.

  If you change your mind later, you must contact the Friend of the Court (FOC). Your answer has no effect on your eligibility for child support services.
---
######## end custody questions ########
---
# --------------------------------------------------------------------
## prior cases
# --------------------------------------------------------------------
# for JOD-only, this is only shown if there are marital children. For other divorce filing types, there are questions needed here even if no marital children. 
---
code: |
  prior_custody_orders_or_family_cases.gather()
  interview_order_prior_cases = True
---
#code: |
#  prior_family_case_or_order[i].??????????
#  prior_family_case_or_order[i].complete = True
#---
id: prior orders or cases table
table: prior_family_case_or_order.table
rows: prior_family_case_or_order
columns:
  - Name: row_item.company_name
#  - Entered family before or during marriage: |
#      "before marriage" if row_item.timing == "premarital" else "during marriage"
edit:
  - company_name
delete buttons: True
confirm: True
---
# LHI Prior Court Cases Part 1
# TODO: question for Amy: should the help text for family division cases exclude custody, paternity, and child support for custody interviews? (See Prior Court Cases Part 1 Dialog in Brett's materials.)
# TODO: maybe ask about prior civil cases AFTER collecting custody/support orders and family division cases? This screen is long and clunky as-is.
id: prior court cases
question: Past court cases
fields:
  - label: |
      % if tool_ID == "JOD_only":
      Are there any prior custody or support orders in Michigan or any other state regarding ${ comma_and_list(children.filter(legal_parent='both'), and_string='or') }?
      % elif tool_ID == "custody_complaint" or tool_ID == "custody_answer":
      Are there any pending or resolved **family division** court cases or orders involving you and ${ OP_label }? 
      % elif tool_ID == "divorce_complaint" or tool_ID == "divorce_answer":
      % if children.there_are_any and len(children.filter(legal_parent="both")) > 0:
      Are there any pending or resolved **family division** court cases or orders in Michigan or any other state involving ${ comma_and_list(children.filter(legal_parent='both'), and_string='or') } or you and your spouse?
      % else:
      Are there any pending or resolved **family division** court cases or orders in Michigan or any other state involving you and your spouse?
      % endif
      % endif
    field: prior_custody_orders_or_family_cases.there_are_any
    datatype: yesnoradio
  - note: |
      % if tool_ID == "custody_complaint" or tool_ID == "custody_answer" or tool_ID == "divorce_complaint" or tool_ID == "divorce_answer":
      ${ collapse_template(family_division_info) }
      % endif
  - note: |
      % if tool_ID == "JOD_only":
      You will enter information for **prior custody cases** on the next page.
      % else:
      You will enter information for **prior family division court cases** on the next page.
      % endif
    js show if: |
      val("has_prior_custody_orders_or_family_cases") === true
  - Is a request for child support **currently pending** in another state?: child_support_request_pending
    datatype: yesnoradio
    js show if: |
      (val("has_prior_custody_orders_or_family_cases") === true || val("has_prior_custody_orders_or_family_cases") === false) && (${ json.dumps(tool_ID) } === "JOD_only" || ${ json.dumps(tool_ID) } === "divorce_complaint")
  - label: |
      % if tool_ID == "divorce_complaint":
      Do you know of any other pending or resolved **civil** actions (not family law cases) between you and ${ OP_label } related to your marriage? For example, has one spouse previously sued the other spouse for a tort, such as assault?
      % elif tool_ID == "custody_complaint":
      Do you know of any other pending or resolved **civil** actions (not family law cases or personal protection order cases) between you and ${ other_parties[0] }? For example, has one parent previously sued the other parent for a tort, such as assault?
      % endif
    field: has_prior_civil_cases
    datatype: yesnoradio
    js show if: |
      (val("child_support_request_pending") === true || val("child_support_request_pending") === false) && (${ json.dumps(tool_ID) } === "custody_complaint" || ${ json.dumps(tool_ID) } === "divorce_complaint")
  - Is that case still active (pending)?: prior_civil_case_is_pending
    datatype: yesnoradio
    required: False
    js show if: |
      val("has_prior_civil_cases") === true
  - If the case was filed in Michigan, select the county:: prior_civil_case_county
    required: False
    code: court_list._load_courts()["address_county"].unique() + " County"
    js show if: |
      val("has_prior_civil_cases") === true && val("prior_civil_case_filed_outside_MI") === false
  - The case was filed outside the state of Michigan: prior_civil_case_filed_outside_MI
    required: False
    datatype: yesno
    js show if: |
      val("has_prior_civil_cases") === true
  - Type of court: MI_court_type
    required: False
    datatype: radio
    choices:
      - Circuit
      - District
      - Probate
    js show if: |
      val("has_prior_civil_cases") === true && val("prior_civil_case_filed_outside_MI") === false
  - What is the name of the court?: prior_civil_case_non_MI_court
    required: False
    js show if: |
      val("has_prior_civil_cases") === true && val("prior_civil_case_filed_outside_MI") === true
  - What is the case number of that case?: prior_civil_case_number
    required: False
    js show if: |
      val("has_prior_civil_cases") === true
  - What is the **last name** of the judge assigned to that case?: prior_civil_case_judge
    required: False
    js show if: |
      val("has_prior_civil_cases") === true
---
template: family_division_info
subject: |
  Family Division Case Types
content: |
  **Family Division cases in Michigan** include:
  
  * Divorce, annulment, or separate maintenance (sometimes called legal separation)
  % if tool_ID == "divorce_complaint" or tool_ID == "divorce_answer":
  * Custody
  * Paternity
  * Child support
  % endif
  * All types of personal protection orders-- whether for a domestic relationship, sexual assault, or nondomestic stalking
  * Adoption
  * Child protective proceedings
  * Cases involving children who are placed in a state institution by the Family Division of Circuit Court
  * Name change
  * Emancipation
  * Juvenile court cases

  **Other states and countries** may call their family court something different. Cases from outside of Michigan that fall within these categories should be listed where the form asks for pending or resolved family law cases in other states or countries.
---
id: any more family court cases or custody orders?
question: |
  % if tool_ID == "JOD_only":
  Any more prior custody or support orders?
  % else:
  Any more **family division** court cases or orders?
  % endif
subquestion: |
  So far, you have listed&colon;

  ${prior_custody_orders_or_family_cases.table}
fields:
  - label: |
      % if tool_ID == "JOD_only":
      Are there any more prior custody or support orders in Michigan or any other state regarding ${ comma_and_list(children.filter(legal_parent='both'), and_string='or') }?
      % elif tool_ID == "custody_complaint" or tool_ID == "custody_answer":
      Are there any more pending or resolved **family division** court cases or orders involving you and ${ OP_label }? 
      % elif tool_ID == "divorce_complaint" or tool_ID == "divorce_answer":
      % if children.there_are_any and len(children.filter(legal_parent="both")) > 0:
      Are there any more pending or resolved **family division** court cases or orders in Michigan or any other state involving ${ comma_and_list(children.filter(legal_parent='both'), and_string='or') } or you and your spouse?
      % else:
      Are there any more pending or resolved **family division** court cases or orders in Michigan or any other state involving you and your spouse?
      % endif
      % endif
    field: prior_custody_orders_or_family_cases.there_is_another
    datatype: yesnoradio
---
# LHI "Prior Family Cases DLG"
# probably need to adjust state collection based on home state stuff (and possibly apply to civil case collection too?)
id: prior case or order collection screen
question: |
  % if tool_ID == "JOD_only":
  ${ capitalize(ordinal(i)) } custody or support order
  % else:
  ${ capitalize(ordinal(i)) } **family division** case or order
  % endif
subquestion: |
  ${prior_custody_orders_or_family_cases.question_text_table_template}
fields:
  - Are you the named policy holder?: users[0].insurance[i].in_own_name
    datatype: yesnoradio
    required: False
  - Please enter the name of the policy holder: users[0].insurance[i].policyholder
    required: False
    show if:
      variable: users[0].insurance[i].in_own_name
      is: False
  - What is the name of the provider?: users[0].insurance[i].company_name
  - What is the address of the provider?: users[0].insurance[i].company_address
    required: False
  - What is the policy number?: users[0].insurance[i].policy_number
    required: False
  - What is the certificate number?: users[0].insurance[i].certificate_number
    required: False
  - What coverage does the policy provide?: users[0].insurance[i].coverage_type
    required: False
    datatype: checkboxes
    choices:
      - medical
      - dental
      - optical/vision
      - other
    none of the above: False
  - Does this policy cover ${ children }?: users[0].insurance[i].covers_child
    datatype: yesnoradio
    required: False
---


---
# --------------------------------------------------------------------
## health insurance collection
# --------------------------------------------------------------------
---
code: |
  users[0].insurance[i].company_name
  users[0].insurance[i].complete = True
---
code: |
  other_parties[0].insurance[i].company_name
  other_parties[0].insurance[i].complete = True
---
id: user insurance table
table: users[0].insurance.table
rows: users[0].insurance
columns:
  - Name: row_item.company_name
#  - Entered family before or during marriage: |
#      "before marriage" if row_item.timing == "premarital" else "during marriage"
edit:
  - company_name
delete buttons: True
confirm: True
---
# LHI "Health Coverage" (with kids version) (but we're using a different structure)
id: user's health_coverage (with children)
question: |
  Health coverage
subquestion: |
fields:
  - label: |
      Do you have your own health care coverage, either through an employer, Medicaid or Medicare, or privately? **Do not include health care coverage provided by ${ OP_label } or ${ OP_label }’s employer here.**
    field: users[0].insurance.there_are_any
    datatype: yesnoradio
---
# LHI "Health Coverage" (with kids version) (but we're using a different structure)
id: OP's health_coverage (with children)
question: |
  Health coverage
subquestion: |
fields:
  - label: |
      Does ${ OP_label } hold their own health care coverage, either through an employer, Medicaid or Medicare, or privately?
    field: other_parties[0].insurance.there_are_any
    datatype: yesnoradio
---
id: user has any more health insurance
question: |
  Do you have any more health care policies?
subquestion: |
  So far, you have listed&colon;

  ${users[0].insurance.table}

  **Do not include health care coverage provided by ${ OP_label } or ${ OP_label }’s employer here.**
fields:
  - Do you have another health care policy to add?: users[0].insurance.there_is_another
    datatype: yesnoradio
---
id: OP has any more health insurance
question: |
  Does ${ OP_label } have any more health care policies?
subquestion: |
  So far, you have listed&colon;

  ${other_parties[0].insurance.table}
fields:
  - Does ${ OP_label } have another health care policy to add?: other_parties[0].insurance.there_is_another
    datatype: yesnoradio
---
if: len(children.filter(legal_parent="both")) == 1
id: user insurance policy info (1 marital child)
question: |
  Your ${ ordinal(i) } health care policy
subquestion: |
  ${users[0].insurance.question_text_table_template}
fields:
  - Are you the named policy holder?: users[0].insurance[i].in_own_name
    datatype: yesnoradio
    required: False
  - Please enter the name of the policy holder: users[0].insurance[i].policyholder
    required: False
    show if:
      variable: users[0].insurance[i].in_own_name
      is: False
  - What is the name of the provider?: users[0].insurance[i].company_name
  - What is the address of the provider?: users[0].insurance[i].company_address
    required: False
  - What is the policy number?: users[0].insurance[i].policy_number
    required: False
  - What is the certificate number?: users[0].insurance[i].certificate_number
    required: False
  - What coverage does the policy provide?: users[0].insurance[i].coverage_type
    required: False
    datatype: checkboxes
    choices:
      - medical
      - dental
      - optical/vision
      - other
    none of the above: False
  - Does this policy cover ${ children }?: users[0].insurance[i].covers_child
    datatype: yesnoradio
    required: False
---
if: len(children.filter(legal_parent="both")) > 1
id: user insurance policy info (multiple marital children)
question: |
  Your ${ ordinal(i) } health care policy
subquestion: |
  ${users[0].insurance.question_text_table_template}
fields:
  - Are you the named policy holder?: users[0].insurance[i].in_own_name
    datatype: yesnoradio
    required: False
  - Please enter the name of the policy holder: users[0].insurance[i].policyholder
    required: False
    show if:
      variable: users[0].insurance[i].in_own_name
      is: False
  - What is the name of the provider?: users[0].insurance[i].company_name
  - What is the address of the provider?: users[0].insurance[i].company_address
    required: False
  - What is the policy number?: users[0].insurance[i].policy_number
    required: False
  - What is the certificate number?: users[0].insurance[i].certificate_number
    required: False
  - What coverage does the policy provide?: users[0].insurance[i].coverage_type
    required: False
    datatype: checkboxes
    choices:
      - medical
      - dental
      - optical/vision
      - other
    none of the above: False
  - Does this policy cover any of these children?: users[0].insurance[i].covers_child
    required: False
    datatype: checkboxes
    none of the above: False
    code: |
      children.filter(legal_parent="both")    
---
if: len(children.filter(legal_parent="both")) == 1
id: OP insurance policy info (1 marital child)
question: |
  ${ capitalize(OP_label) }'s ${ ordinal(i) } health care policy
subquestion: |
  ${other_parties[0].insurance.question_text_table_template}
fields:
  - Is ${ OP_label } the named policy holder?: other_parties[0].insurance[i].in_own_name
    datatype: yesnoradio
    required: False
  - Please enter the name of the policy holder: other_parties[0].insurance[i].policyholder
    required: False
    show if:
      variable: other_parties[0].insurance[i].in_own_name
      is: False
  - What is the name of the provider?: other_parties[0].insurance[i].company_name
  - What is the address of the provider?: other_parties[0].insurance[i].company_address
    required: False
  - What is the policy number?: other_parties[0].insurance[i].policy_number
    required: False
  - What is the certificate number?: other_parties[0].insurance[i].certificate_number
    required: False
  - What coverage does the policy provide?: other_parties[0].insurance[i].coverage_type
    required: False
    datatype: checkboxes
    choices:
      - medical
      - dental
      - optical/vision
      - other
    none of the above: False
  - Does this policy cover ${ children }?: other_parties[0].insurance[i].covers_child
    datatype: yesnoradio
    required: False
---
if: len(children.filter(legal_parent="both")) > 1
id: OP insurance policy info (multiple marital children)
question: |
  ${ capitalize(OP_label) }'s ${ ordinal(i) } health care policy
subquestion: |
  ${other_parties[0].insurance.question_text_table_template}
fields:
  - Is ${ OP_label } the named policy holder?: other_parties[0].insurance[i].in_own_name
    datatype: yesnoradio
    required: False
  - Please enter the name of the policy holder: other_parties[0].insurance[i].policyholder
    required: False
    show if:
      variable: other_parties[0].insurance[i].in_own_name
      is: False
  - What is the name of the provider?: other_parties[0].insurance[i].company_name
  - What is the address of the provider?: other_parties[0].insurance[i].company_address
    required: False
  - What is the policy number?: other_parties[0].insurance[i].policy_number
    required: False
  - What is the certificate number?: other_parties[0].insurance[i].certificate_number
    required: False
  - What coverage does the policy provide?: other_parties[0].insurance[i].coverage_type
    required: False
    datatype: checkboxes
    choices:
      - medical
      - dental
      - optical/vision
      - other
  - Does this policy cover any of these children?: other_parties[0].insurance[i].covers_child
    required: False
    datatype: checkboxes
    none of the above: False
    code: |
      children.filter(legal_parent="both")    
---
# --------------------------------------------------------------------
## income tax info
# --------------------------------------------------------------------
---
code: |
  income_tax_method
  if income_tax_method == "specify_per_child":
    for child in children:
      if child.legal_parent == "both":
        child.tax_parent
  elif income_tax_method == "alternate_years":
    tax_deductions_who_first
  interview_order_income_tax = True
---
# LHI "Income Taxes", (only used in divorce_complaint and JOD_only per Brett spreadsheet)
id: income tax question
question: Income taxes
subquestion: |
  Under federal tax law, the parent who a child lives with for the greater number of nights during the year is entitled to claim tax deductions, credits, and exemptions for that child. This includes state, federal, and local deductions, credits, and exemptions. 

  ${ collapse_template(federal_tax_default_info) }

  Even though the parent with the greater number of overnights is entitled to claim the child, you and your spouse may agree to something different. For example, even if you will have more parenting time overnights, you may agree that your spouse can claim your child for tax purposes in exchange for something you want in your property settlement. 
fields:
  - label: |
      % if len(children.filter(legal_parent="both")) == 1:
      How will income tax deductions, credits, and exemptions for ${ children[0] } be divided between you and your spouse? 
      % elif len(children.filter(legal_parent="both")) > 1:
      How will income tax deductions, credits, and exemptions for the children be divided between you and your spouse? 
      % endif
    field: income_tax_method
    datatype: radio
    code: |
      tax_choices
  - Beginning in what year?: tax_start_year
    datatype: integer
    min: |
     ${ today().year - 10 }
    max: 3000
    js show if: |
      val("income_tax_method") === "user" || val("income_tax_method") === "other_party" || val("income_tax_method") === "specify_per_child" || val("income_tax_method") === "alternate_years"
---
# TO DO: going to have to clear this out and rebuild if # of children changes
code: |
  tax_choices = [
                  ['default', f'Based on federal tax law, the parent with whom the { children.as_noun() } { children.does_verb("live") } for the greater number of nights during the year will be awarded all income tax deductions, credits, and exemptions for the minor { children.as_noun() }, including state, federal, or local tax returns, for all tax years.'],
                  ['user', f'{ users[0] } will be awarded all income tax deductions, credits, and exemptions for the minor { children.as_noun() }, including state, federal, or local tax returns, for all tax years.'],
                  ['other_party', f'{ other_parties[0] } will be awarded all income tax deductions, credits, and exemptions for the minor { children.as_noun() }, including state, federal, or local tax returns, for all tax years.']
                ]
  
  if len(children.filter(legal_parent="both")) > 1:
    tax_choices.append(['specify_per_child', f'{ users[0] } and { other_parties[0] } will claim the deductions, credits, and exemptions for different children, including state, federal, or local tax returns.'])
  
  tax_choices.append(['alternate_years', f'{ users[0] } and { other_parties[0] } will claim all deductions, credits, and exemptions for the { children.as_noun() } in alternating years, including state, federal, or local tax returns.'])
---
id: income tax deductions starting year
Question: Who gets income tax deductions first?
subquestion: |
  You said that you and ${ other_parties[0] } will claim income tax deductions in alternating years, starting in tax year ${ tax_start_year }. 
fields:
  - Who will be awarded the income tax deductions for tax year ${ tax_start_year }?: tax_deductions_who_first
    datatype: radio
    choices:
      - I will: users[0]
      - My spouse will: other_parties[0]
  - note: |
      OK, You will get the deductions, credits, and exemptions for tax year ${ tax_start_year }. ${ other_parties[0] } will claim them for tax year ${ tax_start_year + 1 }.
    show if:
      variable: tax_deductions_who_first
      is: users[0]
  - note: |
      OK, ${ other_parties[0] } will get the deductions, credits, and exemptions for tax year ${ tax_start_year }. You will claim them for tax year ${ tax_start_year + 1 }.
    show if:
      variable: tax_deductions_who_first
      is: other_parties[0]
---
template: federal_tax_default_info
subject: |
  More info about giving tax benefits based on the actual number overnights (the first option)
content: |
  Choosing this option can have a  different effect than specifically giving the tax deductions, credits, and exemptions to the parent who has the greater number of parenting time overnights based on the Judgment of Divorce. 
  
  If the parties do not follow their Judgment of Divorce, and the parent who was supposed to have more overnights ends up having less than 50% of the overnights in one year, then this provision would allow the parent who **actually had over 50% of the overnights** to claim the tax credits, etc., **instead of the parent who was awarded more overnights.**)
---
id: specific child tax election
question: Tax deductions, exemptions, and credits for ${ children[i] }
fields:
  - Who will claim the deductions, exemptions, and credits for ${ children[i] }?: children[i].tax_parent
    datatype: radio
    choices:
      - I will: users[0]
      - My spouse will: other_parties[0]
---
event: test_end_screen
question: Thank you for testing!
subquestion: You have finished the initial child questions test interview.
