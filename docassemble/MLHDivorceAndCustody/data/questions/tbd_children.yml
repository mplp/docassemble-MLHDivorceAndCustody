# example date to avoid marriage question
code: |
  marriage.date = "1986-09-20T00:00:00-04:00" 
---
### need the stuff in this section (copied from main yml) here for now to run just this yml
generic object: DAList
template: x.collapsed_table_template
subject: |
  So far, you have listed...
content: |
  ${x.table.show(editable=False)}
---
features:
  labels above fields: True
---
generic object: DAList
template: x.question_table_template
content: |
  % if x.number_gathered() > 1:
  ${collapse_template(x.collapsed_table_template)}
  % endif
---
include:
  - docassemble.AssemblyLine:assembly_line.yml
  - docassemble.ALToolbox:collapse_template.yml
  - docassemble.mlhframework:mlh_interview_framework.yml
---
objects:
  - children: ALPeopleList.using(
      complete_attribute="complete",
      )
  - marriage: DAObject
### need the above for now to run just this yml
---
### possibly move the below to main yml
terms:
  - phrases:
      - assisted reproduction
    definition: |
      Assisted reproduction is a way to become pregnant that is not sexual intercourse. It includes:

      * Donor insemination
      * Sperm or egg donation
      * Embryo donation
      * In vitro fertilization (IVF) and embryo transfer
      * Intracytoplasmic sperm injection
      * Assisted reproductive technology
---
table: children.table
rows: children
columns:
  - Name: row_item.name
  - Date of birth: row_item.birthdate
  - Entered family before or during marriage: |
      "before marriage" if row_item.timing == "premarital" else "during marriage"
edit:
  - name
  - birthdate
  - timing
delete buttons: True
confirm: True
---
id: child questions
mandatory: True # remove later
code: |
  children.gather()
---
code: |
  children[i].name.first
  children[i].timing 
  children[i].origin
  children[i].legal_parent
    
   
      
  
  children[i].complete = True
---
id: other_parties_0_gender
question: |
  What is your spouse's gender?
fields:
  - code: |
      other_parties[0].gender_fields(show_help=True)
---
id: users_0_pregnant
question: |
  Pregnancy
fields:
  - label: To the best of your knowledge are you pregnant?
    field: users[0].pregnant
    datatype: yesnoradio
---
id: other_parties_0_pregnant
question: |
  Pregnancy
fields:
  - label: To the best of your knowledge is your spouse pregnant?
    field: other_parties[0].pregnant
    datatype: yesnoradio
#---
#id: children_there_are_any_same_sex
#question: |
# Children
#fields:
#  - label: Do you and your spouse have minor children together?
#    field: children_there_are_any_same_sex
#    datatype: yesnoradio
#---
#id: children_both_legal_parents
#question: |
#  Children
#subquestion: |
#  You are both the legal parents if one of you is a biological parent and you were married to each other when the child was born or conceived.
#fields:
#  - label: Are you and your spouse both the legal parents of the child or children?
#    field: children_both_legal_parents
#    datatype: yesnomaybe
#---
#code: |
#  if users[0].gender == other_parties[0].gender:
#    if children_there_are_any_same_sex and children_both_legal_parents:
#      children.there_are_any = True
#    else:
#      children.there_are_any = False
#  else:
#    pass
---
id: any children
question: |
  Minor children
fields:
  - Do you and your spouse have any minor children, either together or separately?: children.there_are_any
    datatype: yesnoradio
---
id: any more children
question: |
  Any more children?
subquestion: |
  Please list **all minor children** that you or your spouse have, either separately or together.
  
  You have already told us about:

  ${children.table}
fields:
  - Are there any more minor children to add?: children.there_is_another
    datatype: yesnoradio
---
on change:
  children.there_are_any: |
    if not children.there_are_any:
      children.target_number = 0
      children.clear()
---
id: children info
sets:
  - children[i].name.first
  - children[i].name.middle
  - children[i].name.last
  - children[i].name.suffix
question: |
  % if i == 0:
  Child's information
  % else:
  ${ ordinal(i) } child's information
  % endif
subquestion: |
  ${children.question_table_template}
fields:
  - code: |
      children[i].name_fields()
  - Date of birth: children[i].birthdate
    datatype: BirthDate
  - My spouse and I **adopted** this child together during our marriage.: children[i].adopted_during_marriage
    required: False
    datatype: yesno
  # need help text saying don't include children who were born to or adopted by either spouse prior to marriage
  - Gender: children[i].gender
    datatype: radio
    choices:
      - Female: female
      - Male: male
  - Social security number: ssn
    datatype: ssn
    required: False
---
code: |
  if children[i].adopted_during_marriage:
    children[i].timing = "marital"
  else:
    if int(date_difference(starting=marriage.date, ending=children[i].birthdate).days) < 0:
      children[i].timing = "premarital"
    elif int(date_difference(starting=marriage.date, ending=children[i].birthdate).days) > 0:
      children[i].timing = "marital"
---
if: not children[i].adopted_during_marriage and int(date_difference(starting=marriage.date, ending=children[i].birthdate).days) == 0
Question: Which was first?
fields:
  - Was ${children[i]} born before or after you got married?: children[i].timing
    datatype: radio
    choices: 
      - ${children[i]} was born before we got married.: premarital
      - ${children[i]} was born after we got married.: marital
---
id: marital children's origin
if: children[i].timing == "marital" and not children[i].adopted_during_marriage
question: |
  About ${children[i]}
fields:
  - Which of these applies to ${children[i]}?: children[i].origin
    datatype: radio
    choices:
      - My spouse or I **gave birth** to ${children[i]} as a result of **sex between me and my spouse**.: marital_sex
      - My spouse or I **gave birth** to  ${children[i]} as a result of **sex with someone else** (not the other spouse).: third_party_conceived
      - My spouse or I **gave birth** to ${children[i]} using **assisted reproduction** (for example, donor insemination or in vitro fertilization (IVF)).: assisted_reproduction # could we combine this with marital sex?
      - ${children[i]} was born through surrogacy.: marital_surrogacy
      - My spouse or I conceived ${children[i]} with someone else but did not give birth to them.: third_party_birth ## adding this, need to check with Amy. These would be stepkids. need to ask who bio parent is, as well as for who they live with and possibly address
      # - We adopted ${children[i]}. ## maybe don't need this one, instead set via code?
  - note: |
      ${ collapse_template(why_ask_child_origin) }
      ${ collapse_template(help_assisted_repro) }
  - Did the surrogacy agreement comply with Michigan law or another state's laws?: children[i].legal_parent
    datatype: radio
    choices:
      - Yes: both
      - No: neither
    js show if: |
      val("children[i].origin") == "marital_surrogacy" && val("children[i].surrogacy_need_more_info") == false
  - I don't know.: children[i].surrogacy_need_more_info
    required: False
    datatype: yesno
    show if:
      variable: children[i].origin 
      is: marital_surrogacy
  - note: |
      There may be a legal parentage issue that can affect your divorce case. Custody, parenting time, and child support for ${children[i]} can only be decided in this divorce if the surrogacy agreement was legally valid. 
      
      Before you continue using this tool, talk to a lawyer to find out if your surrogacy agreement complied with the law of Michigan or another state. ${MLH_GUIDE_FULL}
      
      To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    show if:
      variable: children[i].surrogacy_need_more_info
      is: True
  - note: |
      This means that ${children[i]} will **not** be included in the sections about custody, parenting time, and child support in your Judgment of Divorce. If you have questions about parentage or need legal advice, you may want to talk to a lawyer. ${MLH_GUIDE_FULL}
    js show if: |
      val("children[i].surrogacy_compliance") == false && val("children[i].surrogacy_need_more_info") == false
validation code: |
  if children[i].origin == "marital_surrogacy" and children[i].surrogacy_need_more_info:
    validation_error("You need to uncheck this box and answer the question above to continue.", field="children[i].surrogacy_need_more_info")
---
template: why_ask_child_origin
subject: |
  Why are you asking this?
content: |
  Depending on your answer, we may need to give you more information about parentage.
---
template: help_assisted_repro
subject: |
  What does "assisted reproduction" mean?
content: |
  Assisted reproduction is a way to become pregnant that is not sexual intercourse. It includes:
  
    * Donor insemination
    * Sperm or egg donation
    * Embryo donation
    * In vitro fertilization (IVF) and embryo transfer
    * Intracytoplasmic sperm injection
    * Assisted reproductive technology
---
id: adopted child set origin and legal parents
code: |
  if children[i].adopted_during_marriage:
    children[i].origin = "marital_adoption"
    children[i].legal_parent = "both"
---
id: set legal parents for certain situations
code: |
  if children[i].origin == "marital_sex" or children[i].origin == "assisted_reproduction":
    children[i].legal_parent = "both"
  elif children[i].origin == "premarital_sex_or_assisted_repro_with_spouse" and (children[i].parentage_established == "yes" or (children[i].parentage_established == "unknown" and children[i].both_on_birth_cert == True)):
    children[i].legal_parent = "both"
#  elif children[i].origin == "marital_surrogacy" and 
  
---
id: third_party_conceived followup
if: children[i].origin == "third_party_conceived"
question: ${children[i]}'s legal parents
fields:
  - Who gave birth to ${children[i]}?: children[i].birthing_parent
    datatype: radio
    choices:
      - I did: user
      - My spouse did: other_party
  - Has your spouse's parentage been revoked (canceled) by a court order?  This would only happen if you, your spouse, or the child's other biological parent filed a complaint or motion to revoke your spouse's parentage, and the judge granted it.: children[i].legal_parent
    datatype: radio
    choices: 
      - Yes, my spouse's parentage was revoked by a court order.: user
      - No, my spouse's parentage was not revoked by a court order.: both
    show if:
      variable: children[i].birthing_parent
      is: user
  - Has your parentage been revoked by a court order?  This would only happen if you, your spouse, or the child's other biological parent filed a complaint or motion to revoke your parentage, and the judge granted it.: children[i].legal_parent
    datatype: radio
    choices: 
      - Yes, my parentage was revoked by a court order.: other_party
      - No, my parentage was not revoked by a court order.: both
    show if:
      variable: children[i].birthing_parent
      is: other_party
  - Do you and your spouse agree that you should continue as ${children[i]}'s legal parent after your divorce?: children[i].want_retain_parentage
    datatype: yesnoradio
    js show if: |
      val("children[i].legal_parent") == "both" && val("children[i].birthing_parent") == "other_party"
  - Do you and your spouse agree that your spouse should continue as ${children[i]}'s legal parent after your divorce?: children[i].want_retain_parentage
    datatype: yesnoradio
    js show if: |
      val("children[i].legal_parent") == "both" && val("children[i].birthing_parent") == "user"
  - note: |
      If the judge revokes your spouse's parentage before your divorce is final, you will need to update the Judgment of Divorce before presenting it to the judge. You can do this by returning to this tool and changing your answer to the question above that asks if parentage was revoked, and then re-downloading the Judgment of Divorce form.

      You, your spouse, or the child's other biological parent can file a motion as part of your divorce case asking the judge to revoke (undo) your spouse's legal parentage. To prepare this motion, use the [Do-It-Yourself Revoke Parentage Established by Marriage tool](https://michiganlegalhelp.org/resources/family/do-it-yourself-revoke-parentage-established-marriage). You will need to start the divorce case before you can file the parentage motion.

      If nobody files a Motion to Determine Child Born Out of Wedlock, your spouse will remain a legal parent. This means the judge can award them custody and/or parenting time, and they may be responsible for paying child support. A motion to revoke parentage can also be filed after your divorce is final, but the judge may be less likely to grant the motion when the child is older. To learn more, go to the page that applies to you on the Michigan Legal Help website: [Revoking Marriage-Based Parentage: For the Mother or Birthing Parent](https://michiganlegalhelp.org/resources/family/revoking-marriage-based-parentage-mother-or-birthing-parent), or [Revoking Marriage-Based Parentage: For the Husband or Spouse](https://michiganlegalhelp.org/resources/family/revoking-marriage-based-parentage-husband-or-spouse).
    js show if: |
      val("children[i].legal_parent") == "both" && val("children[i].birthing_parent") == "user" && val("children[i].want_retain_parentage") == false
  - note: |
      If the judge revokes your parentage before your divorce is final, you will need to update the Judgment of Divorce before presenting it to the judge. You can do this by returning to this tool and changing your answer to the question above that asks if parentage was revoked, and then re-downloading the Judgment of Divorce form.

      You, your spouse, or the child's other biological parent can file a motion as part of your divorce case asking the judge to revoke (undo) your legal parentage. To prepare this motion, use the [Do-It-Yourself Revoke Parentage Established by Marriage tool](https://michiganlegalhelp.org/resources/family/do-it-yourself-revoke-parentage-established-marriage). You will need to start the divorce case before you can file the parentage motion.

      If nobody files a Motion to Determine Child Born Out of Wedlock, you will remain a legal parent. This means the judge can award you custody and/or parenting time, and you may be responsible for paying child support. A motion to revoke parentage can also be filed after your divorce is final, but the judge may be less likely to grant the motion when the child is older. To learn more, go to the page that applies to you on the Michigan Legal Help website: [Revoking Marriage-Based Parentage: For the Mother or Birthing Parent](https://michiganlegalhelp.org/resources/family/revoking-marriage-based-parentage-mother-or-birthing-parent), or [Revoking Marriage-Based Parentage: For the Husband or Spouse](https://michiganlegalhelp.org/resources/family/revoking-marriage-based-parentage-husband-or-spouse).
    js show if: |
      val("children[i].legal_parent") == "both" && val("children[i].birthing_parent") == "other_party" && val("children[i].want_retain_parentage") == false
---
id: premarital children's origin
if: children[i].timing == "premarital" 
question: |
  About ${children[i]}
fields:
  - Which of these applies to ${children[i]}?: children[i].origin
    datatype: radio
    choices:
      - My current spouse and I had ${children[i]} **together** as a result of sex or assisted reproduction.: premarital_sex_or_assisted_repro_with_spouse
      - My current spouse and I had ${children[i]} **together** as a result of a surrogacy agreement.: premarital_surrogacy_with_spouse
      - My current spouse or I had ${children[i]} **with someone else** through sex, assisted reproduction, surrogacy, or adoption.: premarital_with_another
      - My spouse or I had ${children[i]} alone, through a single-parent adoption or through assisted reproduction without a second intended parent.: premarital_alone
  - note: |
      ${ collapse_template(why_ask_child_origin) }
      ${ collapse_template(help_assisted_repro) }
---
id: premarital children of sex, assisted repro
if: children[i].timing == "premarital" and children[i].origin == "premarital_sex_or_assisted_repro_with_spouse"
question: ${children[i]}'s legal parents 
subquestion: ${ collapse_template(why_ask_child_origin) }
fields:
  - Who gave birth to ${children[i]}?: children[i].birthing_parent
    datatype: radio
    choices:
      - I did.: user
      - My spouse did.: other_party
  - Did your spouse become a legal parent of ${children[i]}?: children[i].parentage_established
    datatype: radio
    choices:
      - Yes: yes
      - No: no
      - I don't know.: unknown
    show if:
      variable: children[i].birthing_parent
      is: user
  - Did you become a legal parent of ${children[i]}?: children[i].parentage_established
    datatype: radio
    choices:
      - Yes: yes
      - No: no
      - I don't know.: unknown
    show if:
      variable: children[i].birthing_parent
      is: other_party
  - note: |
      Before you can use this tool to get divorce forms, you need to become a legal parent so your divorce can include custody, parenting time, and child support for all children in common. To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    js show if: |
      val("children[i].birthing_parent") == "other_party" && val("children[i].parentage_established") == "no"
  - note: |
      Before you can use this tool to get divorce forms, your spouse needs to become a legal parent so your divorce can include custody, parenting time, and child support for all children in common. To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    js show if: |
      val("children[i].birthing_parent") == "user" && val("children[i].parentage_established") == "no"
  - Are both your and your spouse's names listed on ${children[i]}'s birth certificate as parents?: children[i].both_on_birth_cert
    datatype: yesnoradio
    show if: 
      variable: children[i].parentage_established
      is: unknown
  - note: |
      If you are not listed on the birth certificate, this could mean either that:
      
      * your spouse is the only legal parent, **or** 
      * the birth certificate was not updated after you became a legal parent. 
      
      Make sure that you are a legal parent before you use this tool to get divorce forms. This is so your divorce can include custody, parenting time, and child support for all your children in common with your spouse. To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    js show if: |
      val("children[i].birthing_parent") == "other_party" && val("children[i].both_on_birth_cert") == false
  - note: |
      If your spouse is not listed on the birth certificate, this could mean either that:
      
      * you are the only legal parent, **or**
      * the birth certificate was not updated after your spouse became a legal parent. 
      
      Make sure that your spouse is a legal parent before you use this tool to get divorce forms. This is so your divorce can include custody, parenting time, and child support for all your children in common with your spouse. To learn more, read [How to Become a Legal Parent](https://michiganlegalhelp.org/resources/family/how-become-legal-parent).
    js show if: |
      val("children[i].birthing_parent") == "user" && val("children[i].both_on_birth_cert") == false
validation code: |
  if children[i].parentage_established == "no":
    validation_error("Both parents must become legal parents before you can use this tool to get divorce forms.", field="children[i].parentage_established")
  elif children[i].parentage_established == "unknown" and children[i].both_on_birth_cert == False:
    validation_error("Both parents must become legal parents before you can use this tool to get divorce forms.", field="children[i].both_on_birth_cert")
---
# id: premarital children, surrogacy
# if: children[i].timing == "premarital" and children[i].origin == "premarital_surrogacy"
# question: ${children[i]}'s legal parents 
# subquestion: ${ collapse_template(why_ask_child_origin) }
# fields:
#   -  Did you have a lawyer to make sure your surrogacy agreement was legally valid?
---
id: premarital children with third party
if: children[i].timing == "premarital" and children[i].origin == "premarital_with_another"
question: ${children[i]}'s legal parents 
subquestion: ${ collapse_template(why_ask_child_origin) }
fields:
  - Who is ${children[i]}'s biological parent?: children[i].bio_parent
    datatype: radio
    choices:
      - I am.: children[i].bio_parent = user
      - My spouse is.: children[i].bio_parent = other_party
  - Did you become ${children[i]}'s legal parent?: children[i].parentage_established
    datatype: radio
    choices:
      - No.: no
      - Yes, I became ${children[i]}'s legal parent through **stepparent adoption**.: stepparent_adoption
      - Yes, I became ${children[i]}'s legal parent by an **Affidavit of Parentage.**: affidavit
    show if:
      variable: children[i].bio_parent
      is: other_party
  - Did your spouse become ${children[i]}'s legal parent?: children[i].parentage_established
    datatype: radio
    choices:
      - No.: no
      - Yes, they became ${children[i]}'s legal parent through **stepparent adoption**.: stepparent_adoption
      - Yes, they became ${children[i]}'s legal parent by an **Affidavit of Parentage.**: affidavit
    show if:
      variable: children[i].bio_parent
      is: user
  - How was ${children[i]} conceived?: children[i].how_conceived
    datatype: radio
    choices:
      - By sexual intercourse: sex
      - By assisted reproduction: assisted_reproduction
    show if:
      variable: children[i].parentage_established
      is: affidavit
  - Has your parentage been revoked (canceled) by a court order? This would only happen if you, your spouse, or the child’s biological father filed a complaint or motion to revoke parentage, and the judge granted it.: children[i].parentage_revoked
    datatype: yesnoradio
    js show if: |
      val("children[i].bio_parent") == "other_party" && val("children[i].how_conceived") == "sex"
  - Has your spouse's parentage been revoked (canceled) by a court order? This would only happen if you, your spouse, or the child’s biological father filed a complaint or motion to revoke parentage, and the judge granted it.: children[i].parentage_revoked
    datatype: yesnoradio
    js show if: |
      val("children[i].bio_parent") == "user" && val("children[i].how_conceived") == "sex"
  - Do you plan to ask the court to revoke your legal parentage of ${children[i]} as part of this divorce case?: children[i].parentage_plan_to_revoke
    datatype: radio
    choices:
      - Yes, I want to ask the court to revoke my parentage.: True
      - No, I want to continue as legal parent.: False
    js show if: |
      val("children[i].bio_parent") == "other_party" && val("children[i].parentage_revoked") == false
  - Do you plan to ask the court to revoke your spouse's legal parentage of ${children[i]} as part of this divorce case?: children[i].parentage_plan_to_revoke
    datatype: radio
    choices:
      - Yes, I want to ask the court to revoke my spouse's parentage.: True
      - No, I want my spouse to continue as legal parent.: False
    js show if: |
      val("children[i].bio_parent") == "other_party" && val("children[i].parentage_revoked") == false
  - note: |
      To do this, you can file a [Complaint/Motion and Affidavit to Revoke Acknowledgment of Parentage](https://www.courts.michigan.gov/49302a/siteassets/forms/scao-approved/cc435_new.pdf) along with the forms you file to start your divorce case. You may want to consider finding a lawyer to help you.
      
      If the judge revokes your parentage before your divorce is final, you will need to update the Judgment of Divorce before presenting it to the judge. You can do this by returning to this tool and changing your answers on this page, then re-downloading the Judgment of Divorce form.
    show if:
      variable: children[i].parentage_plan_to_revoke
      is: True

---
# TODO: confirm usage of "under text"
id: children_target_number
question: |
  Children
subquestion: |
  Children together are those children who have both you and your spouse as legal parents, whether you became their parents during your marriage or before, not including stepchildren.
fields:
  - label: How many minor children do you and your spouse have together?
    field: children.target_number
    datatype: integer
    min: 1
---
