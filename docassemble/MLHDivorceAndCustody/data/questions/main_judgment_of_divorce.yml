---
include:
  - divorce_custody_setup.yml
---
# TODO subtitle? & confirm description
metadata:
  title: Michigan Judgment of Divorce
  short title: Michigan Judgment of Divorce
  description: |
    Self-help interview to obtain a Judgment of Divorce and other documents needed to finish a divorce in Michigan.
  tags:
    - Family
  authors:
    - Michigan Legal Help
    - Lemma Legal
---
sections:
  - signpost_intro: "Introduction"
  - signpost_qualify: "Is this tool right for you?"
  - signpost_user: "Your Information"
  - signpost_spouse: "Spouse's Information"
  - signpost_marriage: "Marriage Information"
  - signpost_children: "Children"
  - signpost_income_etc: "Income, Insurance, etc."
  - signpost_personal_property: "Property and Debt"
  - signpost_judgment_information: "Judgment Information"
  - signpost_done: "Get Your Forms"
  - review_full: "âœŽ <u>Review / Edit</u>"
---
# TODO need survey url
code: |
  survey_link_url_only = "https://www.surveymonkey.com/r/xxxxxx"
---
code: |
  tool_ID = "JOD_only"
---
# TODO need survey script
template: survey_embed_script
content: |
  <script>
  </script>
---
# set intro landing screen variables
code: |
  # TODO confirm form type
  MLH_form_type = "Judgment of Divorce"
  MLH_time_min = 15
  MLH_time_max = 45

  # TODO need resource url & confirm page name
  resource_page_url_only = "https://michiganlegalhelp.org/node/xxxx"
  resource_page_name = "Judgment of Divorce"

  # E-signature not supported for JOD Only
  MLH_esign_supported = False
---
template: MLH_welcome_message
content: |
  Welcome to Michigan Legal Help's Do-It-Yourself ${MLH_form_type} tool.

  This tool will help you prepare forms to finish your divorce in Michigan. Use this tool if all you need is a Judgment of Divorce and the forms that go with it.
---
# ====================================================================
## interview_order
# ====================================================================
---
id: interview_order_michigan_judgment_of_divorce
mandatory: True
scan for variables: False
code: |
  set_persistent_labels
  nav.set_section("review_full")
  nav.set_section("signpost_intro")
  MLH_standard_intro_pages

  nav.set_section("signpost_qualify")
  if not marriage.pending_divorce:
    exit_no_pending_divorce

  county_choice # TODO custom? "In what county was the divorce filed?"
  court_index
  the_court
  docket_number
  user_ask_role
  set_JOD_party_labels

  if not marriage.breakdown:
    exit_no_marriage_breakdown

  marriage.request_spousal_support
  if not marriage.request_spousal_support_continue:
    exit_general

  if marriage.have_pension_retirement:
    marriage.pension_retirement_accounts_keep_own
    if not marriage.pension_retirement_accounts_continue:
      exit_general

  if marriage.have_financial_instruments:
    if marriage.financial_instruments_held_together:
      marriage.financial_instruments_held_together_agree_about_division
      if not marriage.financial_instruments_held_together_continue:
        exit_general
    else:
      if marriage.financial_instruments_keep_or_divide == "divide":
        exit_general
      elif marriage.financial_instruments_keep_or_divide == "keep":
        if not marriage.financial_instruments_keep_own_continue:
          exit_general

  if marriage.have_business:
    exit_general

  if marriage.have_experienced_domestic_violence:
    if not marriage.have_experienced_domestic_violence_continue:
      exit_general

  nav.set_section("signpost_user")

  users.gather()
  users[0].name.first
  users[0].previous_last_name_yn
  users[0].new_last_name_yn
  users[0].gender
  users[0].pregnant
  users[0].marriage_number
  users[0].birthdate
  users[0].birthplace

  interview_order_user_contact_info

  nav.set_section("signpost_spouse")

  other_parties.gather()
  other_parties[0].name.first
  other_parties[0].previous_last_name_yn
  other_parties[0].gender
  other_parties[0].pregnant
  other_parties[0].marriage_number
  other_parties[0].birthdate
  other_parties[0].birthplace

  other_parties[0].address.address
  if other_parties[0].address.state == "MI":
    other_parties[0].village_or_township_yn
  if other_parties[0].mailing_address.yesno:
    other_parties[0].mailing_address.address

  other_parties[0].phone_number
  other_parties[0].email

  interview_order_other_parties_attorney

  nav.set_section("signpost_marriage")

  interview_order_spousal_support
  
  marriage.date
  marriage.address.city
  if not marriage.living_together_yn:
    marriage.living_together_stopped_date

  nav.set_section("signpost_children")
  interview_order_children

  if there_are_marital_children:
    interview_order_prior_cases

    nav.set_section("signpost_income_etc")
    users[0].insurance.gather()
    other_parties[0].insurance.gather()
    if users[0].insurance.there_are_any or other_parties[0].insurance.there_are_any:
      marriage.cobra_coverage
    interview_order_user_employment
    interview_order_user_identifying_info
    interview_order_other_party_employment
    interview_order_other_party_identifying_info
    interview_order_income_tax

  nav.set_section("signpost_property")

  interview_order_personal_property
  interview_order_debts
  interview_order_vehicles
  marriage.real_property.gather()
  if not there_are_marital_children:
    marriage.cobra_coverage

  nav.set_section("signpost_judgment_information")

  if marriage.other_provisions_any:
    marriage.other_provisions

  if marriage.temporary_order:
    marriage.temporary_order_changed

  if not marriage.true_statement:
    exit_general

  # load value of these so that they populate forms as expected
  plaintiffs
  defendants

  nav.set_section("signpost_done")
  MLH_standard_outro_pages
  MLH_download
---
# EKM note: interview_order code blocks moved from here to question_bank.yml
---
# ====================================================================
## documents
# ====================================================================
---
objects:
  - judgment_ccmlh412: ALDocument.using(title="Judgment", filename="Judgment.pdf", enabled=True, default_overflow_message=AL_DEFAULT_OVERFLOW_MESSAGE)
---
objects:
  - al_user_bundle: ALDocumentBundle.using(elements=[judgment_ccmlh412], filename="Michigan Divorce and Custody JOD", title="Divorce and Custody JOD", enabled=True)
---
attachment:
  - name: Judgment ccmlh412 (no kids)
    filename: Judgment ccmlh412 (no kids)
    variable name: judgment_ccmlh412[i]
    pdf template file: judgment_ccmlh412_no_kids.pdf
    fields:
      - trial_court_circuit: |
          % if the_court.type == "circuit":
          ${the_court.number}
          % endif
      - docket_number: ${docket_number}
      - trial_court_county: ${the_court.address.county}
      - trial_court_address_on_one_line: ${the_court.address.on_one_line()}
      - trial_court_phone_number: ${ the_court.phone }
      - defendants_block: |
          ${defendants}
          ${defendants[0].address.on_one_line()}
          ${word("Does not have phone") if defendants[0].no_phone_number else defendants[0].phone_numbers()}
      - plaintiffs_block: |
          ${plaintiffs}
          ${plaintiffs[0].address.on_one_line()}
          ${word("Does not have phone") if plaintiffs[0].no_phone_number else plaintiffs[0].phone_numbers()}
      - plaintiffs1_name: ${plaintiffs}
      - defendants1_name: ${defendants}
      - spousal_support_none: Yes
      - spousal_support_reserved: No
      - spousal_support_awarded: No
      - personal_property_as_is: |
          ${not personal_property_in_addendum(marriage)}
      - personal_property_in_addendum: |
          ${personal_property_in_addendum(marriage)}
      - debts_none: ${not debts_in_addendum(marriage)}
      - debts_pay_debts_in_own_name: ${marriage.debts.any and marriage.attr("debts.pay_debts_in_own_names")}
      - debts_in_addendum: ${debts_in_addendum(marriage)}
      - vehicles_none: ${not marriage.vehicles.any}
      - vehicles_keep_same: ${marriage.vehicles.any and marriage.attr("vehicles.keep_own")}
      - vehicles_in_addendum: ${marriage.vehicles.any and not marriage.attr("vehicles.keep_own")}
      - real_property_none: ${not bool(marriage.real_property)}
      - real_property_in_addendum: ${bool(marriage.real_property)}
      - pensions_none: ${not marriage.have_pension_retirement}
      - pensions_keep_own: ${marriage.have_pension_retirement and marriage.attr("pension_retirement_accounts_keep_own")}
      - pensions_in_addendum: ${marriage.have_pension_retirement and not marriage.attr("pension_retirement_accounts_keep_own")}
      - total_pages: ""
      - wants_name_change: ${users[0].new_last_name_yn}
      - name_change_plaintiff: ${plaintiffs[0].attr("new_last_name_yn")}
      - name_change_defendant: ${defendants[0].attr("new_last_name_yn")}
      - new_name: ${users[0].attr("new_last_name")}
      - has_personal_property_debt_addendum: ${personal_property_in_addendum(marriage) or debts_in_addendum(marriage)}
      - has_vehicle_addendum: ${has_vehicle_addendum(marriage)}
      - has_real_property_addendum: ${bool(marriage.real_property)}
      - has_pension_addendum: ${marriage.have_pension_retirement and not marriage.attr("pension_retirement_accounts_keep_own")}
      - has_other_provisions: ${marriage.other_provisions_any}
      - other_provisions: ${marriage.attr("other_provisions")}
---
# The following functions are here so that the logic can be kept consistent,
# since these logical checks are used in multiple fields of the document.
---
code: |
  def personal_property_in_addendum(marriage: DAObject) -> bool:
    return marriage.personal_property_acquired and (
      not marriage.attr("personal_property_division_agreement")
      or not marriage.attr("personal_property_division_actual")
    )
---
code: |
  def debts_in_addendum(marriage: DAObject) -> bool:
    return marriage.debts.any and (
      not marriage.attr("debts.agree_responsibility_debts_own_name")
      or marriage.attr("debts.any_in_both_names")
    )
---
code: |
  def has_vehicle_addendum(marriage: DAObject) -> bool:
    return (
      marriage.vehicles.any
      and not marriage.attr("vehicles.keep_own")
      and any(not item.agree for item in marriage.vehicles)
    )
---
