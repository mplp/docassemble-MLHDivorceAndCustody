---
include:
  - docassemble.FeeWaiverRequest:shared_code.yml
  - divorce_custody_setup.yml
---
# TODO subtitle? & confirm description
metadata:
  title: Michigan Complaint for Divorce
  short title: Michigan Divorce Complaint
  description: |
    Self-help interview to get documents needed to file for divorce in Michigan.
  tags:
    - Family
  authors:
    - Michigan Legal Help
    - Lemma Legal
---
sections:
  - signpost_intro: "Introduction"
  - signpost_qualify: "Is this tool right for you?"
  - signpost_user: "Your Information"
  - signpost_spouse: "Spouse's Information"
  - signpost_support: "Spousal Support"
  - signpost_children: "Children"
  - signpost_prior_cases: "Past Cases"
  - signpost_income_etc: "Income, Insurance, etc."
  - signpost_property: "Property and Debt"
  - signpost_last_section: "Final Questions"
  - signpost_done: "Get Your Forms"
  - review_full: "âœŽ <u>Review / Edit</u>"
---
# set static instructions variables
# TODO need survey url
code: |
  survey_link_url_only = "https://www.surveymonkey.com/r/xxxxxx"
---
code: |
  tool_ID = "divorce_complaint"
---
code: |
  if there_are_marital_children:
    docket_number = "                         -DM"
  else:
    docket_number = "                         -DO"
depends on:
  - there_are_marital_children
---
# TODO need survey script
template: survey_embed_script
content: |
  <script>
  </script>
---
# set intro landing screen variables
code: |
  MLH_form_type = "forms"
  MLH_time_min = 20
  MLH_time_max = 60
---
template: MLH_welcome_message
content: |
  Welcome to the Do-It-Yourself Divorce tool.

  This tool will help you prepare the forms you need to ask the court for a divorce. This tool may not be able to help you with every aspect of your divorce. In some cases, you may want to have a lawyer help you finish the divorce process. ${MLH_GUIDE_FULL}
---
# ====================================================================
## interview_order
# ====================================================================
---
id: interview_order_michigan_judgment_of_divorce
mandatory: True
scan for variables: False
code: |
  set_persistent_interview_specific_logic
  nav.set_section("review_full")
  nav.set_section("signpost_intro")
  MLH_standard_intro_pages

  nav.set_section("signpost_qualify")
  if marriage.pending_divorce:
    exit_general

  if not marriage.breakdown:
    exit_no_marriage_breakdown
  if spouse_is_incompetent:
    exit_general
  if spouse_is_in_military and military_spouse_agrees_consent_judgment != "yes":
    exit_general

  if marriage.have_experienced_domestic_violence:
    if not marriage.have_experienced_domestic_violence_continue:
      exit_general

  if marriage.have_pension_retirement:
    marriage.pension_retirement_accounts_keep_own
    if not marriage.pension_retirement_accounts_continue:
      exit_general

  if marriage.have_business:
    exit_general

  if need_temporary_order:
    if not temporary_order_continue:
      exit_general
  
  returning_to_finalize #TODO can we ask need_temporary_order only if not returning_to_finalize?

  nav.set_section("signpost_user")

  users.gather()
  users[0].name.first
  users[0].has_previous_name
  users[0].new_last_name_yn
  users[0].gender
  users[0].marriage_number
  users[0].birthdate
  users[0].birthplace

  interview_order_user_contact_info

  nav.set_section("signpost_spouse")

  other_parties.gather()
  other_parties[0].name.first
  other_parties[0].has_previous_name
  other_parties[0].gender
  other_parties[0].marriage_number
  other_parties[0].birthdate
  other_parties[0].birthplace

  interview_order_other_parties_address_info

  if not ((users[0].lives_in_Michigan and users[0].has_lived_6_months_MI) or (other_parties[0].lives_in_Michigan and other_parties[0].has_lived_6_months_MI)):
     exit_jurisdiction

  if other_parties[0].address.country != "US":
    international_service_warning

  other_parties[0].village_or_township_yn  
  other_parties[0].address.county # skipped if already asked on lives_in_Michigan screen
  if other_parties[0].mailing_address.yesno:
    other_parties[0].mailing_address.address
  other_parties[0].no_phone_number
  other_parties[0].email

  nav.set_section("signpost_support")
  interview_order_spousal_support

  nav.set_section("signpost_children")
  interview_order_children
  interview_order_pregnancy

  nav.set_section("signpost_prior_cases")
  prior_family_cases.gather()
  child_support_pending_elsewhere
  has_prior_civil_cases

  nav.set_section("signpost_income_etc") 
  if there_are_marital_children:
    users[0].insurance.gather()
    other_parties[0].insurance.gather()
    if users[0].insurance.there_are_any or other_parties[0].insurance.there_are_any:
      marriage.cobra_coverage
  
  elif not there_are_marital_children:
    marriage.cobra_coverage

  if there_are_marital_children or user_wants_post_divorce_support: #FOC23+FOC100
    interview_order_user_employment
    interview_order_user_income
    interview_order_user_identifying_info
    users[0].has_alias
    interview_order_other_party_employment
    interview_order_other_party_income
    interview_order_other_party_identifying_info
    other_parties[0].has_alias
  elif spousal_support_provisions == "user_agrees_to_pay_spousal_support" or (returning_to_finalize and marriage.temporary_order): #FOC100
    interview_order_user_employment
    interview_order_user_income
    interview_order_user_identifying_info
    interview_order_other_party_employment
    interview_order_other_party_identifying_info
  else: 
    interview_order_user_income

  nav.set_section("signpost_property")

  marriage.marital_property_info
  reiterate_marital_property
  interview_order_personal_property
  interview_order_vehicles
  marriage.real_property.gather()
  interview_order_debts
  if there_are_marital_children:
    interview_order_income_tax

  nav.set_section("signpost_last_section")

  marriage.date
  marriage.address.city
  if not marriage.living_together_yn:
    marriage.living_together_stopped_date
    if there_are_marital_children:
      marriage.number_children_in_home_when_separated

  check_for_required_venue
  venue 

  if marriage.other_provisions_any:
    marriage.other_provisions

  if not marriage.true_statement:
    exit_general

  MLH_standard_outro_pages

  # just making sure these are defined
  the_court
  the_foc 
  docket_number
  stepchildren_for_addendum
  plaintiffs
  defendants

  nav.set_section("signpost_done")
  MLH_download
---

# ====================================================================
## interview_order - for testing divorce instructions
# ====================================================================
# To test, make the main interview order block not mandatory and the below block mandatory
# ---
# id: interview_order_instructions_test
# mandatory: True
# scan for variables: False
# code: |
#   tool_ID = "divorce_complaint"
#   divorce_instructions_test
#   instructions_test_download
# ---
# id: Choose a court
# question: |
#   Select test parameters.
# subquestion: |
# fields:
#   - County: county_choice
#     code: court_list._load_courts()["address_county"].unique()
#   - With or without children: there_are_marital_children
#     input type: radio
#     code: |
#       [ { False : 'Without' }, { True : 'With' } ]  
# continue button field: divorce_instructions_test
# 
# ---
# id: TestDownloadScreen
# event: instructions_test_download
# question: |
#   Get your instructions!
# subquestion: |
#   You can **view**, **download**, or **e-mail** your ${ MLH_form_type } to yourself below.
# 
#   ${ al_user_bundle.download_list_html() }
# 
#   ${ al_user_bundle.send_button_html(show_editable_checkbox=True) }
# ---
# objects:
#   - al_user_bundle: ALDocumentBundle.using(elements=[instructions], enabled=True)